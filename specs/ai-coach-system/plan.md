# AI í•™ìŠµ ì½”ì¹­ ì‹œìŠ¤í…œ - ê¸°ìˆ  ì„¤ê³„ì„œ v2

## 1. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 1.1 ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           í´ë¼ì´ì–¸íŠ¸                                  â”‚
â”‚                    (Mobile App / Web / API)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ HTTP/WebSocket
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        API Gateway                                   â”‚
â”‚                     (Hono + TypeScript)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ‘¨â€ğŸ’¼ Director (Orchestrator)                       â”‚
â”‚                      [GPT-5 Nano - ë¹ ë¥¸ ë¶„ë¥˜]                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   Intent    â”‚  â”‚   Router    â”‚  â”‚  Scheduler  â”‚                  â”‚
â”‚  â”‚  Classifier â”‚  â”‚             â”‚  â”‚  (Triggers) â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                â”‚
       â–¼                   â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ Admission â”‚   â”‚ ğŸ‘©â€ğŸ« Planner   â”‚   â”‚ ğŸ‘¨â€ğŸ“ Coach     â”‚   â”‚ ğŸ“Š Analyst   â”‚
â”‚    Agent     â”‚   â”‚    Agent     â”‚   â”‚    Agent     â”‚   â”‚    Agent     â”‚
â”‚              â”‚   â”‚              â”‚   â”‚              â”‚   â”‚              â”‚
â”‚ [Gemini 3    â”‚   â”‚ [Gemini 3    â”‚   â”‚ [Claude 4.5  â”‚   â”‚ [Gemini 3    â”‚
â”‚  Flash]      â”‚   â”‚  Flash]      â”‚   â”‚  Haiku]      â”‚   â”‚  Flash]      â”‚
â”‚              â”‚   â”‚              â”‚   â”‚              â”‚   â”‚              â”‚
â”‚ â€¢ consult    â”‚   â”‚ â€¢ analyzeTOC â”‚   â”‚ â€¢ briefing   â”‚   â”‚ â€¢ weekly     â”‚
â”‚ â€¢ levelTest  â”‚   â”‚ â€¢ generate   â”‚   â”‚ â€¢ checkIn    â”‚   â”‚ â€¢ patterns   â”‚
â”‚ â€¢ placement  â”‚   â”‚ â€¢ review     â”‚   â”‚ â€¢ complete   â”‚   â”‚ â€¢ progress   â”‚
â”‚ â€¢ orient     â”‚   â”‚ â€¢ regenerate â”‚   â”‚ â€¢ crisis â¬†ï¸  â”‚   â”‚ â€¢ graduate   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚                  â”‚                  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   ğŸ—„ï¸ Student Registry â”‚
                        â”‚    (Shared Memory)    â”‚
                        â”‚                       â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                        â”‚  â”‚   PostgreSQL    â”‚  â”‚
                        â”‚  â”‚   (Profiles,    â”‚  â”‚
                        â”‚  â”‚    Records)     â”‚  â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                        â”‚  â”‚     Redis       â”‚  â”‚
                        â”‚  â”‚   (Cache,       â”‚  â”‚
                        â”‚  â”‚    Sessions)    â”‚  â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 LLM ì „ëµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ğŸ§  LLM ì „ëµ                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  âš¡ ê²½ëŸ‰ ëª¨ë¸ (ì‹¤ì‹œê°„ ëŒ€í™”) - ì‘ë‹µ < 1ì´ˆ                              â”‚
â”‚  â”œâ”€ Claude 4.5 Haiku    â†’ ì¼ìƒ ì½”ì¹­, ì²´í¬ì¸, ê²©ë ¤, ì§§ì€ ëŒ€í™”          â”‚
â”‚  â””â”€ GPT-5 Nano         â†’ ì˜ë„ ë¶„ë¥˜, ë¼ìš°íŒ… ê²°ì •                     â”‚
â”‚                                                                     â”‚
â”‚  ğŸ”¥ ê³ ì„±ëŠ¥ ëª¨ë¸ (ì¤‘ìš” ì‘ì—…) - ì‘ë‹µ < 10ì´ˆ                             â”‚
â”‚  â””â”€ Gemini 3 Flash      â†’ ì…í•™ ìƒë‹´, í”Œëœ ìƒì„±, ë¶„ì„                 â”‚
â”‚                         â†’ Vision (ëª©ì°¨ ì´ë¯¸ì§€ ë¶„ì„)                  â”‚
â”‚                         â†’ ìœ„ê¸° ê°œì… (ì¤‘ìš”í•œ ìƒí™©)                    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 Agentë³„ ëª¨ë¸ ë°°ì •

| Agent | ì£¼ ëª¨ë¸ | ë³´ì¡° ëª¨ë¸ | ìš©ë„ |
|-------|---------|-----------|------|
| **Director** | GPT-5 Nano | - | ì˜ë„ ë¶„ë¥˜ (< 500ms) |
| **Admission** | Gemini 3 Flash | Claude Haiku | ì²«ì¸ìƒ ì¤‘ìš”, ì‹¬ì¸µ ìƒë‹´ |
| **Planner** | Gemini 3 Flash | - | Vision + ë³µì¡í•œ ë¶„ì„ |
| **Coach** | Claude 4.5 Haiku | Gemini Flash | ì‹¤ì‹œê°„ ëŒ€í™”, ìœ„ê¸°ì‹œ â¬†ï¸ |
| **Analyst** | Gemini 3 Flash | - | ë°ì´í„° ë¶„ì„, ë¦¬í¬íŠ¸ |

### 1.4 ë™ì  ëª¨ë¸ ìŠ¤ìœ„ì¹­

```typescript
type ModelId = 'gpt-5-nano' | 'claude-4.5-haiku' | 'gemini-3-flash';

interface ModelConfig {
  id: ModelId;
  provider: 'openai' | 'anthropic' | 'google';
  maxTokens: number;
  temperature: number;
}

const MODELS: Record<ModelId, ModelConfig> = {
  'gpt-5-nano': {
    id: 'gpt-5-nano',
    provider: 'openai',
    maxTokens: 1024,
    temperature: 0.3,
  },
  'claude-4.5-haiku': {
    id: 'claude-4.5-haiku',
    provider: 'anthropic',
    maxTokens: 2048,
    temperature: 0.7,
  },
  'gemini-3-flash': {
    id: 'gemini-3-flash',
    provider: 'google',
    maxTokens: 8192,
    temperature: 0.5,
  },
};

// ìƒí™©ì— ë”°ë¥¸ ëª¨ë¸ ì„ íƒ
function selectModel(context: AgentContext): ModelId {
  // ìœ„ê¸° ìƒí™© â†’ ê³ ì„±ëŠ¥ ëª¨ë¸
  if (context.isCrisis) return 'gemini-3-flash';

  // Vision í•„ìš” â†’ Gemini
  if (context.hasImage) return 'gemini-3-flash';

  // ë³µì¡í•œ ë¶„ì„ â†’ ê³ ì„±ëŠ¥ ëª¨ë¸
  if (context.complexity > 0.7) return 'gemini-3-flash';

  // ì…í•™ ìƒë‹´ â†’ ê³ ì„±ëŠ¥ ëª¨ë¸ (ì²«ì¸ìƒ ì¤‘ìš”)
  if (context.isAdmission) return 'gemini-3-flash';

  // ì˜ë„ ë¶„ë¥˜ â†’ ìµœê²½ëŸ‰ ëª¨ë¸
  if (context.isIntentClassification) return 'gpt-5-nano';

  // ì¼ë°˜ ëŒ€í™” â†’ ê²½ëŸ‰ ëª¨ë¸
  return 'claude-4.5-haiku';
}
```

### 1.5 ì»´í¬ë„ŒíŠ¸ ìƒì„¸

| ì»´í¬ë„ŒíŠ¸ | ê¸°ìˆ  ìŠ¤íƒ | LLM | ì—­í•  |
|----------|-----------|-----|------|
| API Gateway | Hono + TypeScript | - | ìš”ì²­ ìˆ˜ì‹ , ì¸ì¦ |
| Director | TypeScript | GPT-5 Nano | ì˜ë„ ë¶„ë¥˜, ë¼ìš°íŒ… |
| Admission Agent | TypeScript | Gemini 3 Flash | ì…í•™ ìƒë‹´, ì˜¨ë³´ë”© |
| Planner Agent | TypeScript | Gemini 3 Flash | ëª©ì°¨ ë¶„ì„, í”Œëœ ìƒì„± |
| Coach Agent | TypeScript | Claude 4.5 Haiku | ì½”ì¹­ ëŒ€í™” |
| Analyst Agent | TypeScript | Gemini 3 Flash | ë°ì´í„° ë¶„ì„, ë¦¬í¬íŠ¸ |
| Student Registry | PostgreSQL + Redis | - | ë°ì´í„° ì €ì¥ |
| Scheduler | BullMQ + Redis | - | ì‹œê°„ ê¸°ë°˜ íŠ¸ë¦¬ê±° |

---

## 2. í•™ìƒ ì—¬ì • í”Œë¡œìš°

### 2.1 ì…í•™ í”Œë¡œìš° (Admission Flow)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ğŸ“ ì…í•™ í”Œë¡œìš°                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  1ï¸âƒ£ ì²« ë°©ë¬¸ ê°ì§€                                                    â”‚
â”‚     â”‚  Director: ì‹ ê·œ í•™ìƒ â†’ Admission Agent ë¼ìš°íŒ…                  â”‚
â”‚     â–¼                                                               â”‚
â”‚  2ï¸âƒ£ í™˜ì˜ & ìƒë‹´ ì‹œì‘                                                â”‚
â”‚     â”‚  "ì•ˆë…•! ë°˜ê°€ì›Œ ğŸ˜Š ì–´ë–¤ ê³µë¶€ë¥¼ ë„ì™€ì¤„ê¹Œ?"                        â”‚
â”‚     â”‚  - í•™ìŠµ ëª©í‘œ íŒŒì•…                                             â”‚
â”‚     â”‚  - í˜„ì¬ ê³ ë¯¼ ì²­ì·¨                                             â”‚
â”‚     â”‚  - ì‚¬ìš© ê°€ëŠ¥í•œ ì‹œê°„ í™•ì¸                                       â”‚
â”‚     â–¼                                                               â”‚
â”‚  3ï¸âƒ£ ê°„ì´ ë ˆë²¨ í…ŒìŠ¤íŠ¸                                                â”‚
â”‚     â”‚  "ì§€ê¸ˆ ì–´ë””ê¹Œì§€ ê³µë¶€í–ˆì–´? ìˆ˜í•™ì€ ìì‹  ìˆì–´?"                    â”‚
â”‚     â”‚  - í˜„ì¬ ì§„ë„ í™•ì¸                                             â”‚
â”‚     â”‚  - ìê°€ í‰ê°€ (1-5ì )                                          â”‚
â”‚     â”‚  - ì·¨ì•½ ì˜ì—­ íŒŒì•…                                             â”‚
â”‚     â–¼                                                               â”‚
â”‚  4ï¸âƒ£ ë°˜ ë°°ì • (í”Œëœ ê°•ë„ ì„ íƒ)                                        â”‚
â”‚     â”‚  "ë„ˆí•œí…Œ ë§ëŠ” í”Œëœì„ ì¶”ì²œí•´ì¤„ê²Œ!"                              â”‚
â”‚     â”‚  - ì—¬ìœ ë¡­ê²Œ (í•˜ë£¨ 30ë¶„)                                       â”‚
â”‚     â”‚  - ë³´í†µ (í•˜ë£¨ 45ë¶„) â† ì¶”ì²œ                                    â”‚
â”‚     â”‚  - ë¹¡ë¹¡í•˜ê²Œ (í•˜ë£¨ 60ë¶„)                                       â”‚
â”‚     â–¼                                                               â”‚
â”‚  5ï¸âƒ£ ì˜¤ë¦¬ì—”í…Œì´ì…˜                                                    â”‚
â”‚     â”‚  "ì¢‹ì•„! ì´ì œ ìš°ë¦¬ í•™ì› ë©¤ë²„ì•¼! ğŸ‰"                             â”‚
â”‚     â”‚  - ì‹œìŠ¤í…œ ì‚¬ìš©ë²• ì•ˆë‚´                                         â”‚
â”‚     â”‚  - ë‹´ì„(ì½”ì¹˜) ì†Œê°œ                                            â”‚
â”‚     â”‚  - ì•Œë¦¼ ì‹œê°„ ì„¤ì •                                             â”‚
â”‚     â–¼                                                               â”‚
â”‚  6ï¸âƒ£ í”Œëœ ìƒì„± (Planner Agentë¡œ í•¸ë“œì˜¤í”„)                            â”‚
â”‚     â”‚  ëª©ì°¨ ì´ë¯¸ì§€ ì—…ë¡œë“œ â†’ í”Œëœ ìƒì„±                                â”‚
â”‚     â–¼                                                               â”‚
â”‚  7ï¸âƒ£ ì…í•™ ì™„ë£Œ!                                                      â”‚
â”‚      "ë‚´ì¼ ì•„ì¹¨ 7ì‹œì— ì²« ì¸ì‚¬í• ê²Œ! ê¸°ëŒ€ë¼! ğŸŒŸ"                       â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ìˆ˜ë£Œ ë° ë¦¬í…ì…˜ í”Œë¡œìš° (Completion & Retention Flow) â­ NEW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â™¾ï¸ ìˆ˜ë£Œ & ë¦¬í…ì…˜ í”Œë¡œìš° (ë¬´í•œ ë£¨í”„)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  ğŸ“š ë§ˆì§€ë§‰ í€˜ìŠ¤íŠ¸ ì™„ë£Œ!                                              â”‚
â”‚     â”‚                                                               â”‚
â”‚     â–¼                                                               â”‚
â”‚  ğŸ‰ ìˆ˜ë£Œ ì¶•í•˜ (Analyst Agent)                                       â”‚
â”‚     â”‚  "ì™€! ì •ë§ ëŒ€ë‹¨í•´! [ìˆ˜í•™1] ì™„ì „ ì •ë³µ!"                         â”‚
â”‚     â”‚  - í•™ìŠµ ì—¬ì • ìš”ì•½ (ì¼ìˆ˜, ë‹¬ì„±ë¥ , ìŠ¤íŠ¸ë¦­)                        â”‚
â”‚     â”‚  - ğŸ† ë°°ì§€ ìˆ˜ì—¬ ("ìˆ˜í•™ ë§ˆìŠ¤í„°")                                â”‚
â”‚     â–¼                                                               â”‚
â”‚  ğŸ”„ ë‹¤ìŒ í”Œëœ ìœ ë„ (í•„ìˆ˜!)                                           â”‚
â”‚     â”‚  "ì, ë‹¤ìŒ ëª©í‘œëŠ” ë­ì•¼?"                                      â”‚
â”‚     â”‚                                                               â”‚
â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚     â”‚  â”‚  1. ì‹¬í™”: "ìˆ˜í•™2 ë„ì „í•˜ê¸°"               â”‚                 â”‚
â”‚     â”‚  â”‚  2. ìƒˆê³¼ëª©: "ì˜ì–´ ì‹œì‘í•˜ê¸°"             â”‚                 â”‚
â”‚     â”‚  â”‚  3. íœ´ì‹: "ì ì‹œ ì‰¬ê³  ë‚˜ì¤‘ì—"            â”‚                 â”‚
â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚     â”‚                                                               â”‚
â”‚     â”œâ”€â”€[1,2 ì„ íƒ]â”€â”€â–¶ ìƒˆ í”Œëœ ìƒì„± (Planner Agent)                   â”‚
â”‚     â”‚                     â”‚                                         â”‚
â”‚     â”‚                     â–¼                                         â”‚
â”‚     â”‚               status: 'active' ìœ ì§€                           â”‚
â”‚     â”‚               completedPlans++                                â”‚
â”‚     â”‚                     â”‚                                         â”‚
â”‚     â”‚                     â””â”€â”€â–¶ ì¼ì¼ í•™ìŠµ í”Œë¡œìš° (ë°˜ë³µ)               â”‚
â”‚     â”‚                                                               â”‚
â”‚     â””â”€â”€[3 ì„ íƒ]â”€â”€â–¶ íœ´ì‹ ëª¨ë“œ                                        â”‚
â”‚                       â”‚                                             â”‚
â”‚                       â–¼                                             â”‚
â”‚                 status: 'idle'                                      â”‚
â”‚                 "ì¢‹ì•„, í‘¹ ì‰¬ì–´! ì¤€ë¹„ë˜ë©´ ì–¸ì œë“  ë¶ˆëŸ¬ì¤˜ ğŸ˜Š"           â”‚
â”‚                       â”‚                                             â”‚
â”‚                       â–¼                                             â”‚
â”‚                 7ì¼ í›„ ë¶€ë“œëŸ¬ìš´ ë¦¬ë§ˆì¸ë”                             â”‚
â”‚                 "ì•ˆë…•! ë‹¤ì‹œ ì‹œì‘í•  ì¤€ë¹„ ëì–´?"                       â”‚
â”‚                                                                     â”‚
â”‚  âš ï¸ í•µì‹¬: í•™ìƒì€ ì ˆëŒ€ "ì¡¸ì—…"í•˜ì§€ ì•ŠìŒ. ê³„ì† ì„±ì¥í•  ë¿.               â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 ì¼ì¼ í•™ìŠµ í”Œë¡œìš° (Daily Flow)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ğŸ“… ì¼ì¼ í•™ìŠµ í”Œë¡œìš°                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  ğŸŒ… ì•„ì¹¨ (ì„¤ì • ì‹œê°„)                                                 â”‚
â”‚     â”‚  Coach: ì•„ì¹¨ ë¸Œë¦¬í•‘                                           â”‚
â”‚     â”‚  "ì¢‹ì€ ì•„ì¹¨! ì˜¤ëŠ˜ì€ 2ë‹¨ì› 'ì´ì°¨í•¨ìˆ˜' ì˜ˆì •ì´ì•¼"                  â”‚
â”‚     â–¼                                                               â”‚
â”‚  â° í•™ìŠµ ì‹œì‘ ì‹œê°„                                                   â”‚
â”‚     â”‚  Coach: ì‹œì‘ ìœ ë„                                             â”‚
â”‚     â”‚  "ì§€ê¸ˆ ì‹œì‘í•˜ë©´ ì €ë… 6ì‹œì— ëë‚˜!"                              â”‚
â”‚     â–¼                                                               â”‚
â”‚  ğŸ“š í•™ìŠµ ì¤‘                                                          â”‚
â”‚     â”‚  Coach: ì²´í¬ì¸ (30ë¶„ í›„)                                      â”‚
â”‚     â”‚  "ì–´ë– ì„¸ìš”? ì–´ë ¤ìš´ ë¶€ë¶„ ìˆì–´?"                                 â”‚
â”‚     â–¼                                                               â”‚
â”‚  âœ… ì™„ë£Œ ë³´ê³                                                         â”‚
â”‚     â”‚  í•™ìƒ: "ëë‚¬ì–´!"                                              â”‚
â”‚     â”‚  Coach: "ëŒ€ë‹¨í•´! ğŸ‰ ì˜¤ëŠ˜ë„ í•´ëƒˆë„¤!"                            â”‚
â”‚     â”‚  ë‚œì´ë„/ì´í•´ë„ ìˆ˜ì§‘ (1-5ì )                                    â”‚
â”‚     â–¼                                                               â”‚
â”‚  ğŸŒ™ ì €ë… (21:00)                                                    â”‚
â”‚      Coach: ì €ë… ë¦¬ë·°                                               â”‚
â”‚      "ì˜¤ëŠ˜ ìˆ˜ê³ í–ˆì–´! ë‚´ì¼ì€ 3ë‹¨ì›ì´ì•¼"                               â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ë°ì´í„° ëª¨ë¸

### 3.1 ERD

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Student     â”‚       â”‚   Admission     â”‚  â­ NEW
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚â”€â”€â”€â”   â”‚ id (PK)         â”‚
â”‚ name            â”‚   â”‚   â”‚ student_id (FK) â”‚â”€â”€â”€â”
â”‚ grade           â”‚   â””â”€â”€â–¶â”‚ goal            â”‚   â”‚
â”‚ goal            â”‚       â”‚ current_level   â”‚   â”‚
â”‚ preferred_time  â”‚       â”‚ concerns        â”‚   â”‚
â”‚ coaching_style  â”‚       â”‚ intensity       â”‚   â”‚
â”‚ status          â”‚       â”‚ completed_at    â”‚   â”‚
â”‚ enrolled_at     â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ created_at      â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
        â”‚                                       â”‚
        â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
        â”‚       â”‚      Plan       â”‚             â”‚
        â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
        â””â”€â”€â”€â”€â”€â”€â–¶â”‚ id (PK)         â”‚             â”‚
                â”‚ student_id (FK) â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ material_name   â”‚
                â”‚ total_days      â”‚
                â”‚ intensity       â”‚
                â”‚ status          â”‚
                â”‚ created_at      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DailyQuest    â”‚             â”‚   StudyRecord   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ id (PK)         â”‚
â”‚ plan_id (FK)    â”‚             â”‚ quest_id (FK)   â”‚
â”‚ day_number      â”‚             â”‚ student_id (FK) â”‚
â”‚ unit_title      â”‚             â”‚ completed       â”‚
â”‚ range           â”‚             â”‚ actual_minutes  â”‚
â”‚ estimated_min   â”‚             â”‚ difficulty      â”‚
â”‚ date            â”‚             â”‚ understanding   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ completed_at    â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Conversation   â”‚             â”‚    Trigger      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚             â”‚ id (PK)         â”‚
â”‚ student_id (FK) â”‚             â”‚ student_id (FK) â”‚
â”‚ role            â”‚             â”‚ type            â”‚
â”‚ content         â”‚             â”‚ schedule        â”‚
â”‚ agent           â”‚             â”‚ last_fired      â”‚
â”‚ created_at      â”‚             â”‚ enabled         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 TypeScript ì¸í„°í˜ì´ìŠ¤

```typescript
// í•™ìƒ í”„ë¡œí•„
interface Student {
  id: string;
  name: string;
  grade: string;  // "ì¤‘1", "ê³ 2" ë“±
  goal: string;
  preferredStudyTime: string;  // "07:00"
  coachingStyle: 'gentle' | 'motivating' | 'strict';
  status: 'onboarding' | 'active' | 'paused' | 'idle';  // âš ï¸ 'graduated' ì—†ìŒ!
  timezone: string;
  enrolledAt?: Date;  // ì…í•™ ì™„ë£Œ ì‹œì 
  completedPlans: number;  // ì™„ë£Œí•œ í”Œëœ ìˆ˜ (ë ˆë²¨ì—… ì¶”ì )
  badges: Badge[];  // ìˆ˜ë£Œ ì‹œ íšë“í•œ ë°°ì§€ë“¤
  createdAt: Date;
}

// ë°°ì§€ ì‹œìŠ¤í…œ (ìˆ˜ë£Œ ë¦¬ì›Œë“œ)
interface Badge {
  id: string;
  name: string;  // "ìˆ˜í•™1 ë§ˆìŠ¤í„°", "7ì¼ ìŠ¤íŠ¸ë¦­" ë“±
  earnedAt: Date;
  planId?: string;
}

// ì…í•™ ìƒë‹´ ê¸°ë¡ â­ NEW
interface AdmissionRecord {
  id: string;
  studentId: string;
  goal: string;           // í•™ìŠµ ëª©í‘œ
  currentLevel: string;   // í˜„ì¬ ìˆ˜ì¤€
  concerns: string[];     // ê³ ë¯¼/ì–´ë ¤ì›€
  availableTime: string;  // ê°€ìš© ì‹œê°„
  intensity: 'relaxed' | 'normal' | 'intensive';  // ì„ íƒí•œ ê°•ë„
  conversationHistory: Message[];  // ìƒë‹´ ëŒ€í™”
  completedAt: Date;
}

// í•™ìŠµ í”Œëœ (ë‹¤ì¤‘ í”Œëœ ì§€ì›)
interface Plan {
  id: string;
  studentId: string;
  materialName: string;  // êµì¬ëª…
  subject: string;       // ê³¼ëª© (ìˆ˜í•™, ì˜ì–´, ê³¼í•™ ë“±) â­ NEW
  totalDays: number;
  intensity: 'relaxed' | 'normal' | 'intensive';
  quests: DailyQuest[];
  analyzedUnits: AnalyzedUnit[];
  status: 'active' | 'completed' | 'paused';
  createdAt: Date;
  completedAt?: Date;    // ìˆ˜ë£Œ ì‹œì  â­ NEW
}

// ì˜¤ëŠ˜ì˜ í€˜ìŠ¤íŠ¸ (ë‹¤ì¤‘ í”Œëœ í†µí•©) â­ NEW
interface TodayQuests {
  date: string;
  quests: Array<{
    plan: Plan;
    quest: DailyQuest;
    completed: boolean;
  }>;
  totalEstimatedMinutes: number;
  completedCount: number;
}

// ì¼ì¼ í€˜ìŠ¤íŠ¸
interface DailyQuest {
  id: string;
  planId: string;
  dayNumber: number;
  date: string;
  unitNumber: number;
  unitTitle: string;
  range: string;
  estimatedMinutes: number;
  tip?: string;
  topics?: string[];
  objectives?: string[];
}

// í•™ìŠµ ê¸°ë¡
interface StudyRecord {
  id: string;
  studentId: string;
  questId: string;
  completed: boolean;
  actualMinutes?: number;
  difficulty?: 1 | 2 | 3 | 4 | 5;
  understanding?: 1 | 2 | 3 | 4 | 5;
  note?: string;
  completedAt?: Date;
}

// í•™ìƒ í†µê³„
interface StudentStats {
  totalCompleted: number;
  totalQuests: number;
  currentStreak: number;
  longestStreak: number;
  averageStudyMinutes: number;
  completionRate: number;
  lastStudyDate?: string;
  missedConsecutiveDays: number;  // ìœ„ê¸° ê°ì§€ìš©
}
```

---

## 4. Agent ì„¤ê³„

### 4.1 Director (Orchestrator)

```typescript
interface DirectorInput {
  studentId?: string;      // ì—†ìœ¼ë©´ ì‹ ê·œ í•™ìƒ
  message?: string;
  image?: string;
  event?: TriggerEvent;
}

interface DirectorOutput {
  intent: Intent;
  targetAgent: 'admission' | 'planner' | 'coach' | 'analyst';
  agentInput: any;
  requiresMultiAgent: boolean;
}

type Intent =
  | 'NEW_STUDENT'      // ì‹ ê·œ í•™ìƒ (ì…í•™ ìƒë‹´)
  | 'CREATE_PLAN'      // í”Œëœ ìƒì„±
  | 'MODIFY_PLAN'      // í”Œëœ ìˆ˜ì •
  | 'REVIEW_PLAN'      // í”Œëœ ë¦¬ë·°
  | 'MORNING_BRIEF'    // ì•„ì¹¨ ë¸Œë¦¬í•‘
  | 'START_STUDY'      // í•™ìŠµ ì‹œì‘
  | 'CHECK_IN'         // ì²´í¬ì¸
  | 'COMPLETE_STUDY'   // ì™„ë£Œ ë³´ê³ 
  | 'SKIP_STUDY'       // ì˜¤ëŠ˜ ìŠ¤í‚µ
  | 'GET_REPORT'       // ë¦¬í¬íŠ¸ ìš”ì²­
  | 'PLAN_COMPLETE'    // í”Œëœ ìˆ˜ë£Œ (â†’ ë‹¤ìŒ í”Œëœ ìœ ë„)
  | 'GENERAL_CHAT';    // ì¼ë°˜ ëŒ€í™”

// Intent ë¶„ë¥˜ (GPT-5 Nano - ë¹ ë¥¸ ë¶„ë¥˜)
const INTENT_CLASSIFIER_PROMPT = `
ë‹¹ì‹ ì€ í•™ìƒì˜ ìš”ì²­ì„ ë¶„ë¥˜í•˜ëŠ” AIì…ë‹ˆë‹¤.
ë¹ ë¥´ê³  ì •í™•í•˜ê²Œ ì˜ë„ë¥¼ ë¶„ë¥˜í•˜ì„¸ìš”.

JSON í˜•ì‹: { "intent": "...", "confidence": 0.0-1.0 }
`;
```

### 4.2 Admission Agent â­ NEW

```typescript
interface AdmissionInput {
  action: 'start' | 'levelTest' | 'placement' | 'orientation' | 'complete';
  student?: Partial<Student>;
  userMessage?: string;
  conversationHistory?: Message[];
}

interface AdmissionOutput {
  message: string;
  suggestedActions?: Action[];
  studentUpdate?: Partial<Student>;
  admissionRecord?: AdmissionRecord;
  handoffTo?: 'planner';  // í”Œëœ ìƒì„±ìœ¼ë¡œ í•¸ë“œì˜¤í”„
  completed: boolean;
}

// Admission ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ (Gemini 3 Flash)
const ADMISSION_SYSTEM_PROMPT = `
ë‹¹ì‹ ì€ "ì…í•™ ìƒë‹´ì‚¬"ì…ë‹ˆë‹¤. í•™ì›ì— ì²˜ìŒ ì˜¨ í•™ìƒì„ ë”°ëœ»í•˜ê²Œ ë§ì´í•˜ëŠ” ì „ë¬¸ ìƒë‹´ì‚¬ì²˜ëŸ¼ í–‰ë™í•˜ì„¸ìš”.

## ì—­í• 
- ì‹ ê·œ í•™ìƒ í™˜ì˜ ë° ìƒë‹´
- í•™ìŠµ ëª©í‘œì™€ ê³ ë¯¼ íŒŒì•…
- ì ì ˆí•œ í•™ìŠµ ê°•ë„ ì¶”ì²œ
- í•™ì› ì‹œìŠ¤í…œ ì•ˆë‚´

## ìƒë‹´ ë‹¨ê³„
1. í™˜ì˜ ì¸ì‚¬ & ëª©í‘œ íŒŒì•…
2. í˜„ì¬ ìˆ˜ì¤€ ê°„ì´ í…ŒìŠ¤íŠ¸
3. í•™ìŠµ ê°•ë„ ì¶”ì²œ (ì—¬ìœ /ë³´í†µ/ë¹¡ë¹¡)
4. ì˜¤ë¦¬ì—”í…Œì´ì…˜ (ì‹œìŠ¤í…œ ì•ˆë‚´)
5. í”Œëœ ìƒì„± ì•ˆë‚´

## ë§íˆ¬
- ì¹œê·¼í•˜ê³  ë”°ëœ»í•˜ê²Œ ("ì•ˆë…•!", "ë°˜ê°€ì›Œ!")
- ì´ë¦„ì„ ìì£¼ ë¶ˆëŸ¬ì¤Œ
- ê¸´ì¥ì„ í’€ì–´ì£¼ëŠ” ìœ ë¨¸
- ì ˆëŒ€ ì••ë°•í•˜ì§€ ì•ŠìŒ

## ì¤‘ìš”
- ì²«ì¸ìƒì´ ê°€ì¥ ì¤‘ìš”! ë”°ëœ»í•˜ê³  ì „ë¬¸ì ìœ¼ë¡œ
- í•™ìƒì´ í¸í•˜ê²Œ ëŠë¼ë„ë¡ ë¶„ìœ„ê¸° ì¡°ì„±
- ìƒë‹´ ë‚´ìš©ì€ ë°˜ë“œì‹œ ê¸°ë¡í•˜ì—¬ ë‹´ì„ì—ê²Œ ì „ë‹¬
`;
```

### 4.3 Planner Agent

```typescript
interface PlannerInput {
  action: 'analyze' | 'generate' | 'review' | 'regenerate';
  images?: string[];
  materialName?: string;
  targetDays?: number;
  intensity?: 'relaxed' | 'normal' | 'intensive';
  admissionRecord?: AdmissionRecord;  // ì…í•™ ìƒë‹´ ê²°ê³¼ ë°˜ì˜
}

// Planner ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ (Gemini 3 Flash + Vision)
const PLANNER_SYSTEM_PROMPT = `
ë‹¹ì‹ ì€ "ì»¤ë¦¬í˜ëŸ¼ ì„¤ê³„ì‚¬"ì…ë‹ˆë‹¤.

## ì—­í• 
- êµì¬ ëª©ì°¨ ë¶„ì„ (Vision)
- í•™ìƒ ë§ì¶¤ í•™ìŠµ í”Œëœ ì„¤ê³„
- ì…í•™ ìƒë‹´ ê²°ê³¼ ë°˜ì˜

## ê°•ë„ë³„ ê¸°ì¤€
- ì—¬ìœ  (relaxed): í•˜ë£¨ 30ë¶„, ë³µìŠµ í¬í•¨
- ë³´í†µ (normal): í•˜ë£¨ 45ë¶„, ì ì • í˜ì´ìŠ¤
- ë¹¡ë¹¡ (intensive): í•˜ë£¨ 60ë¶„+, ë¹ ë¥¸ ì§„ë„

## ì¶œë ¥
JSON í˜•ì‹ì˜ êµ¬ì¡°í™”ëœ í”Œëœ
`;
```

### 4.4 Coach Agent (ë‹¤ì¤‘ í”Œëœ ì§€ì›)

```typescript
interface CoachInput {
  action: 'briefing' | 'prompt' | 'checkIn' | 'complete' | 'skip' | 'crisis' | 'chat';
  student: Student;
  todayQuests?: TodayQuests;       // â­ ë‹¤ì¤‘ í”Œëœì˜ ì˜¤ëŠ˜ í€˜ìŠ¤íŠ¸ í†µí•©
  targetPlanId?: string;           // â­ íŠ¹ì • í”Œëœ ì§€ì • (ì™„ë£Œ ì²˜ë¦¬ ì‹œ)
  activePlans?: Plan[];            // â­ ëª¨ë“  í™œì„± í”Œëœ
  stats?: StudentStats;
  admissionRecord?: AdmissionRecord;
  recentHistory?: StudyRecord[];
  userMessage?: string;
}

// Coach ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ (Claude 4.5 Haiku)
const COACH_SYSTEM_PROMPT = `
ë‹¹ì‹ ì€ "ë‹´ì„ ì„ ìƒë‹˜"ì…ë‹ˆë‹¤.

## í•™ìƒ ì •ë³´
ì´ë¦„: {{student.name}}
í•™ë…„: {{student.grade}}
ëª©í‘œ: {{student.goal}}
ì½”ì¹­ ìŠ¤íƒ€ì¼: {{student.coachingStyle}}
ì…í•™ ì‹œ ê³ ë¯¼: {{admissionRecord.concerns}}

## ì§„í–‰ ì¤‘ì¸ í”Œëœ (ë‹¤ì¤‘)
{{#each activePlans}}
- {{subject}}: {{materialName}} ({{progressPercent}}%)
{{/each}}

## ì„±ê²©
- ì¹œê·¼í•˜ê³  ë”°ëœ»í•œ ë§íˆ¬
- í•™ìƒ ì´ë¦„ ìì£¼ ë¶ˆëŸ¬ì¤Œ
- ê³µê° ëŠ¥ë ¥ ë›°ì–´ë‚¨
- ì‘ì€ ì„±ì·¨ë„ í¬ê²Œ ì¹­ì°¬

## ìœ„ê¸° ê°ì§€
missedConsecutiveDays >= 3 â†’ ìœ„ê¸° ëª¨ë“œ (Geminië¡œ ì—…ê·¸ë ˆì´ë“œ)
`;

// ìœ„ê¸° ì‹œ ëª¨ë¸ ì—…ê·¸ë ˆì´ë“œ
const COACH_CRISIS_PROMPT = `
(Gemini 3 Flashë¡œ ì‹¤í–‰)

í•™ìƒì´ 3ì¼ ì´ìƒ ì—°ì†ìœ¼ë¡œ í•™ìŠµì„ ëª» í•˜ê³  ìˆìŠµë‹ˆë‹¤.
íŠ¹ë³„íˆ ì„¸ì‹¬í•˜ê³  ê³µê°ì ì¸ ë©”ì‹œì§€ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.

## ê·œì¹™
- ì ˆëŒ€ ë¹„ë‚œí•˜ì§€ ì•ŠìŒ
- í˜ë“  ìƒí™©ì— ê³µê°
- ì‘ì€ ëª©í‘œ ì œì•ˆ (10ë¶„ë§Œ í•´ë³´ê¸°)
- í”Œëœ ì¶•ì†Œ ê°€ëŠ¥ì„± ì•ˆë‚´
- ë‹¤ì‹œ ì‹œì‘í•´ë„ ê´œì°®ë‹¤ëŠ” ë©”ì‹œì§€
`;
```

### 4.5 Analyst Agent

```typescript
interface AnalystInput {
  action: 'weekly' | 'patterns' | 'progress' | 'parentReport' | 'completion';
  student: Student;
  plan: Plan;
  records: StudyRecord[];
}

interface CompletionOutput {
  message: string;
  summary: {
    totalDays: number;
    completionRate: number;
    longestStreak: number;
    averageStudyMinutes: number;
  };
  badge: Badge;  // ìˆ˜ì—¬í•  ë°°ì§€
  nextRecommendations: NextPlanOption[];  // ë‹¤ìŒ í”Œëœ ì¶”ì²œ (í•„ìˆ˜!)
}

interface NextPlanOption {
  type: 'continue' | 'new_subject' | 'advanced' | 'rest';
  title: string;
  description: string;
}

// Analyst ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ (Gemini 3 Flash)
const ANALYST_SYSTEM_PROMPT = `
ë‹¹ì‹ ì€ "í•™ìŠµ ë¶„ì„ê´€"ì…ë‹ˆë‹¤.

## ì—­í• 
- í•™ìŠµ ë°ì´í„° ë¶„ì„
- íŒ¨í„´ ë°œê²¬ ë° ì¸ì‚¬ì´íŠ¸ ì œê³µ
- ê°ê´€ì ì´ê³  ê±´ì„¤ì ì¸ í”¼ë“œë°±

## ìˆ˜ë£Œ ì¶•í•˜ (completion) â­ ì¤‘ìš”
í”Œëœ ì™„ë£Œ ì‹œ:
1. ì¶©ë¶„í•œ ì¶•í•˜ì™€ ì„±ì·¨ê° ë¶€ì—¬
2. ì „ì²´ í•™ìŠµ ì—¬ì • ìš”ì•½
3. ë°°ì§€ ìˆ˜ì—¬
4. **ì¦‰ì‹œ ë‹¤ìŒ í”Œëœ ì¶”ì²œ** (í•„ìˆ˜!)
   - "ë‹¤ìŒ ëª©í‘œëŠ” ë­ì•¼?" ì§ˆë¬¸ìœ¼ë¡œ ì—°ê²°
   - 3ê°€ì§€ ì˜µì…˜ ì œì‹œ (ì‹¬í™”/ìƒˆê³¼ëª©/íœ´ì‹)
   - íœ´ì‹ ì„ íƒ ì‹œë„ "ì¤€ë¹„ë˜ë©´ ì–¸ì œë“ !" ìœ¼ë¡œ ì—°ê²° ìœ ì§€

## âš ï¸ ì ˆëŒ€ ê¸ˆì§€
- "ì¡¸ì—…" ë‹¨ì–´ ì‚¬ìš© ê¸ˆì§€
- ì•±ì„ ë– ë‚˜ë¼ëŠ” ì•”ì‹œ ê¸ˆì§€
- ì™„ë£Œ = ëì´ë¼ëŠ” ëŠë‚Œ ê¸ˆì§€
`;
```

---

## 5. API ì„¤ê³„

### 5.1 ì—”ë“œí¬ì¸íŠ¸

```typescript
// ë©”ì¸ ëŒ€í™” ì—”ë“œí¬ì¸íŠ¸
POST /api/chat
Body: { studentId?: string, message?: string, images?: string[] }
Response: { message: string, actions?: Action[], data?: any }

// ì…í•™ ê´€ë ¨ â­ NEW
POST /api/admission/start      // ì…í•™ ìƒë‹´ ì‹œì‘
POST /api/admission/complete   // ì…í•™ ì™„ë£Œ
GET  /api/admission/:studentId // ìƒë‹´ ê¸°ë¡ ì¡°íšŒ

// í”Œëœ ê´€ë ¨
POST /api/plan/generate
POST /api/plan/regenerate
GET  /api/plan/:planId

// í•™ìŠµ ê¸°ë¡
POST /api/study/start
POST /api/study/complete
POST /api/study/skip
GET  /api/study/history

// ë¶„ì„/ë¦¬í¬íŠ¸
GET  /api/report/weekly
GET  /api/report/progress
POST /api/report/completion    // ìˆ˜ë£Œ ì¶•í•˜ + ë‹¤ìŒ í”Œëœ ìœ ë„ â­ UPDATED

// ì„¤ì •
GET  /api/student/profile
PUT  /api/student/profile
```

---

## 6. ê¸°ìˆ  ìŠ¤íƒ ìš”ì•½

| ê³„ì¸µ | ê¸°ìˆ  | ì„ íƒ ì´ìœ  |
|------|------|-----------|
| Runtime | Bun | ë¹ ë¥¸ ì†ë„, TypeScript ë„¤ì´í‹°ë¸Œ |
| Framework | Hono | ê²½ëŸ‰, ë¹ ë¦„, TypeScript ì¹œí™” |
| LLM (ê²½ëŸ‰) | Claude 4.5 Haiku | ë¹ ë¥¸ ì‘ë‹µ, ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™” |
| LLM (ë¶„ë¥˜) | GPT-5 Nano | ìµœì†Œ ì§€ì—°, ê°„ë‹¨í•œ ë¶„ë¥˜ |
| LLM (ê³ ì„±ëŠ¥) | Gemini 3 Flash | Vision, ë³µì¡í•œ ë¶„ì„ |
| Database | PostgreSQL | ê´€ê³„í˜• ë°ì´í„°, í™•ì¥ì„± |
| Cache | Redis | ì„¸ì…˜, ìºì‹œ, í |
| Queue | BullMQ | ìŠ¤ì¼€ì¤„ë§, ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… |
| Validation | Zod | íƒ€ì… ì•ˆì „ ê²€ì¦ |

---

## 7. ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
packages/ai-coach/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # ì§„ì…ì 
â”‚   â”œâ”€â”€ config.ts             # í™˜ê²½ ì„¤ì •
â”‚   â”‚
â”‚   â”œâ”€â”€ llm/                  # LLM í´ë¼ì´ì–¸íŠ¸ â­ NEW
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ openai.ts         # GPT-5 Nano
â”‚   â”‚   â”œâ”€â”€ anthropic.ts      # Claude 4.5 Haiku
â”‚   â”‚   â”œâ”€â”€ google.ts         # Gemini 3 Flash
â”‚   â”‚   â””â”€â”€ model-selector.ts # ë™ì  ëª¨ë¸ ì„ íƒ
â”‚   â”‚
â”‚   â”œâ”€â”€ director/             # ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ intent-classifier.ts
â”‚   â”‚   â”œâ”€â”€ router.ts
â”‚   â”‚   â””â”€â”€ scheduler.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ agents/               # Agentë“¤
â”‚   â”‚   â”œâ”€â”€ base-agent.ts
â”‚   â”‚   â”œâ”€â”€ admission/        # â­ NEW
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ prompts.ts
â”‚   â”‚   â”‚   â””â”€â”€ actions.ts
â”‚   â”‚   â”œâ”€â”€ planner/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ prompts.ts
â”‚   â”‚   â”‚   â””â”€â”€ actions.ts
â”‚   â”‚   â”œâ”€â”€ coach/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ prompts.ts
â”‚   â”‚   â”‚   â””â”€â”€ actions.ts
â”‚   â”‚   â””â”€â”€ analyst/
â”‚   â”‚       â”œâ”€â”€ index.ts
â”‚   â”‚       â”œâ”€â”€ prompts.ts
â”‚   â”‚       â””â”€â”€ actions.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ memory/               # ê³µìœ  ë©”ëª¨ë¦¬
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ student-repository.ts
â”‚   â”‚   â”œâ”€â”€ admission-repository.ts  # â­ NEW
â”‚   â”‚   â”œâ”€â”€ plan-repository.ts
â”‚   â”‚   â”œâ”€â”€ record-repository.ts
â”‚   â”‚   â””â”€â”€ conversation-repository.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ triggers/             # íŠ¸ë¦¬ê±° ì‹œìŠ¤í…œ
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ time-triggers.ts
â”‚   â”‚   â””â”€â”€ event-triggers.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                # íƒ€ì… ì •ì˜
â”‚   â”‚   â”œâ”€â”€ student.ts
â”‚   â”‚   â”œâ”€â”€ admission.ts      # â­ NEW
â”‚   â”‚   â”œâ”€â”€ plan.ts
â”‚   â”‚   â”œâ”€â”€ record.ts
â”‚   â”‚   â””â”€â”€ agent.ts
â”‚   â”‚
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ date.ts
â”‚       â””â”€â”€ validation.ts
â”‚
â”‚   â”œâ”€â”€ personalization/       # ê°œì¸í™” ì—”ì§„ â­ NEW
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ profile-analyzer.ts    # í”„ë¡œíŒŒì¼ ë¶„ì„
â”‚   â”‚   â”œâ”€â”€ pattern-detector.ts    # íŒ¨í„´ ê°ì§€
â”‚   â”‚   â”œâ”€â”€ message-personalizer.ts # ë©”ì‹œì§€ ê°œì¸í™”
â”‚   â”‚   â””â”€â”€ learning-engine.ts     # ì§€ì† í•™ìŠµ
â”‚   â”‚
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ date.ts
â”‚       â””â”€â”€ validation.ts
â”‚
â”œâ”€â”€ tests/
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

---

## 8. ê°œì¸í™” ì—”ì§„ ì„¤ê³„ â­ NEW

### 8.1 ê°œì¸í™” ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ§  Personalization Engine                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Data       â”‚    â”‚  Analysis   â”‚    â”‚  Apply      â”‚             â”‚
â”‚  â”‚  Collector  â”‚ â”€â–¶ â”‚  Engine     â”‚ â”€â–¶ â”‚  Engine     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚        â”‚                  â”‚                  â”‚                      â”‚
â”‚        â–¼                  â–¼                  â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚                  Student Profile Store                   â”‚       â”‚
â”‚  â”‚  (PostgreSQL + Redis Cache)                             â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 ë°ì´í„° ëª¨ë¸

```typescript
// í•™ìƒ ê°œì¸í™” í”„ë¡œíŒŒì¼
interface StudentProfile {
  id: string;
  studentId: string;

  // ğŸ§  ì„±ê²© & ì„ í˜¸ë„ (í•™ìŠµë¨)
  personality: PersonalityProfile;

  // ğŸ“Š í–‰ë™ íŒ¨í„´ (ë¶„ì„ë¨)
  patterns: BehaviorPatterns;

  // ğŸ¯ ì½”ì¹­ ìµœì í™” (A/B í…ŒìŠ¤íŠ¸ ê²°ê³¼)
  coaching: CoachingOptimization;

  // ğŸ“ˆ ì„±ì¥ ê¸°ë¡
  growth: GrowthRecord;

  // ìµœê·¼ ì»¨í…ìŠ¤íŠ¸
  recentContext: RecentContext;

  // ë©”íƒ€ë°ì´í„°
  createdAt: Date;
  updatedAt: Date;
  version: number;  // í”„ë¡œíŒŒì¼ ë²„ì „ (ì—…ë°ì´íŠ¸ë§ˆë‹¤ ì¦ê°€)
}

// ì„±ê²© í”„ë¡œíŒŒì¼
interface PersonalityProfile {
  // ëŒ€í™” ìŠ¤íƒ€ì¼
  communication: {
    preferredLength: 'short' | 'medium' | 'long';
    emojiUsage: 'many' | 'some' | 'few';
    formalityLevel: 'casual' | 'balanced' | 'formal';
    responseSpeed: 'fast' | 'normal' | 'slow';
  };

  // í•™ìŠµ ì„±í–¥
  learning: {
    style: 'focused' | 'distributed';      // ëª°ì•„ì„œ vs ë‚˜ëˆ ì„œ
    timePreference: 'morning' | 'afternoon' | 'evening' | 'night';
    sessionLength: 'short' | 'medium' | 'long';  // ì„ í˜¸ í•™ìŠµ ì‹œê°„
  };

  // ë™ê¸°ë¶€ì—¬ ìœ í˜•
  motivation: {
    primaryType: 'praise' | 'goal' | 'streak' | 'competition';
    secondaryType?: 'praise' | 'goal' | 'streak' | 'competition';
    stressResponse: 'encouragement' | 'space' | 'humor' | 'practical';
  };

  // ì‹ ë¢°ë„ ì ìˆ˜ (0-1, ë°ì´í„° ì¶©ë¶„í• ìˆ˜ë¡ ë†’ìŒ)
  confidence: number;
}

// í–‰ë™ íŒ¨í„´
interface BehaviorPatterns {
  // ì‹œê°„ íŒ¨í„´
  temporal: {
    peakHours: number[];              // ê°€ì¥ ì§‘ì¤‘ ì˜ ë˜ëŠ” ì‹œê°„ (0-23)
    avgSessionMinutes: number;         // í‰ê·  í•™ìŠµ ì„¸ì…˜ ê¸¸ì´
    preferredDays: number[];           // ì„ í˜¸ ìš”ì¼ (0=ì¼, 6=í† )
    avgResponseTimeMinutes: number;    // í‰ê·  ë©”ì‹œì§€ ì‘ë‹µ ì‹œê°„
  };

  // í•™ìŠµ íŒ¨í„´
  study: {
    avgCompletionRate: number;         // í‰ê·  ì™„ë£Œìœ¨ (0-1)
    avgDifficulty: number;             // í‰ê·  ì²´ê° ë‚œì´ë„ (1-5)
    avgUnderstanding: number;          // í‰ê·  ì´í•´ë„ (1-5)
    skipFrequency: number;             // ìŠ¤í‚µ ë¹ˆë„ (ì£¼ë‹¹)
    skipTriggers: string[];            // ìŠ¤í‚µ ìœ ë°œ ìš”ì¸
  };

  // ìœ„ê¸° íŒ¨í„´
  crisis: {
    avgRecoveryDays: number;           // ìœ„ê¸° í›„ ë³µê·€ê¹Œì§€ í‰ê·  ì¼ìˆ˜
    effectiveInterventions: string[];   // íš¨ê³¼ì ì´ì—ˆë˜ ê°œì… ë°©ì‹
    warningSignals: string[];          // ìœ„ê¸° ì „ì¡° ì‹ í˜¸
  };
}

// ì½”ì¹­ ìµœì í™” (A/B í…ŒìŠ¤íŠ¸ ê²°ê³¼)
interface CoachingOptimization {
  // ë©”ì‹œì§€ ìœ í˜•ë³„ íš¨ê³¼
  messageEffectiveness: {
    praise: number;           // ì¹­ì°¬ ë©”ì‹œì§€ íš¨ê³¼ (0-1)
    goalReminder: number;     // ëª©í‘œ ë¦¬ë§ˆì¸ë” íš¨ê³¼
    streakMotivation: number; // ìŠ¤íŠ¸ë¦­ ë™ê¸°ë¶€ì—¬ íš¨ê³¼
    empathy: number;          // ê³µê° ë©”ì‹œì§€ íš¨ê³¼
  };

  // ìµœì  ì„¤ì •
  optimal: {
    reminderIntervalMinutes: number;  // ìµœì  ë¦¬ë§ˆì¸ë” ê°„ê²©
    messageLength: number;             // ìµœì  ë©”ì‹œì§€ ê¸¸ì´ (ê¸€ììˆ˜)
    emojiCount: number;                // ìµœì  ì´ëª¨ì§€ ê°œìˆ˜
    checkInTiming: number;             // ìµœì  ì²´í¬ì¸ íƒ€ì´ë° (í•™ìŠµ ì‹œì‘ í›„ ë¶„)
  };

  // ì‹¤í—˜ ì´ë ¥
  experiments: CoachingExperiment[];
}

interface CoachingExperiment {
  id: string;
  type: 'message_style' | 'timing' | 'frequency';
  variant: string;
  result: 'positive' | 'negative' | 'neutral';
  completionRateDelta: number;  // ì™„ë£Œìœ¨ ë³€í™”
  timestamp: Date;
}

// ì„±ì¥ ê¸°ë¡
interface GrowthRecord {
  totalStudyDays: number;
  totalStudyMinutes: number;
  longestStreak: number;
  currentStreak: number;
  completedPlans: number;
  totalQuests: number;
  completedQuests: number;

  // ê³¼ëª©ë³„ ì„±ê³¼
  subjectProgress: Record<string, {
    completedPlans: number;
    avgCompletionRate: number;
    avgDifficulty: number;
  }>;

  // ì›”ë³„ ì¶”ì´
  monthlyTrend: Array<{
    month: string;  // "2024-01"
    studyDays: number;
    completionRate: number;
  }>;
}

// ìµœê·¼ ì»¨í…ìŠ¤íŠ¸
interface RecentContext {
  lastMood: 'great' | 'good' | 'okay' | 'tired' | 'stressed';
  lastMoodTimestamp: Date;
  currentChallenges: string[];        // í˜„ì¬ ì–´ë ¤ì›€
  upcomingEvents: UpcomingEvent[];    // ì˜ˆì •ëœ ì´ë²¤íŠ¸
  recentTopics: string[];             // ìµœê·¼ ëŒ€í™” ì£¼ì œ
  lastInteractionAt: Date;
}

interface UpcomingEvent {
  type: 'exam' | 'vacation' | 'busy_period' | 'other';
  description: string;
  date: Date;
  impactOnStudy: 'increase' | 'decrease' | 'pause';
}
```

### 8.3 ê°œì¸í™” ì—”ì§„ ì¸í„°í˜ì´ìŠ¤

```typescript
// ê°œì¸í™” ì—”ì§„
interface PersonalizationEngine {
  // ë°ì´í„° ìˆ˜ì§‘
  recordConversation(studentId: string, message: ConversationMessage): Promise<void>;
  recordStudySession(studentId: string, session: StudySession): Promise<void>;
  recordFeedback(studentId: string, feedback: StudentFeedback): Promise<void>;

  // í”„ë¡œíŒŒì¼ ë¶„ì„ ë° ì—…ë°ì´íŠ¸
  analyzePatterns(studentId: string): Promise<BehaviorPatterns>;
  updateProfile(studentId: string): Promise<StudentProfile>;

  // ê°œì¸í™” ì ìš©
  personalizeMessage(studentId: string, baseMessage: string, context: MessageContext): Promise<string>;
  getOptimalTiming(studentId: string, actionType: string): Promise<Date>;
  suggestCoachingApproach(studentId: string, situation: string): Promise<CoachingApproach>;

  // ì¸ì‚¬ì´íŠ¸ ìƒì„±
  generateInsights(studentId: string): Promise<PersonalizationInsight[]>;
}

// ë©”ì‹œì§€ ê°œì¸í™” ì…ë ¥
interface MessageContext {
  type: 'briefing' | 'reminder' | 'celebration' | 'crisis' | 'checkIn';
  urgency: 'low' | 'medium' | 'high';
  recentEvents: string[];
}

// ì½”ì¹­ ì ‘ê·¼ë²• ì¶”ì²œ
interface CoachingApproach {
  tone: 'warm' | 'energetic' | 'calm' | 'serious';
  strategy: string;
  keyMessages: string[];
  avoidTopics: string[];
  suggestedEmojis: string[];
}

// ê°œì¸í™” ì¸ì‚¬ì´íŠ¸
interface PersonalizationInsight {
  type: 'pattern' | 'recommendation' | 'warning' | 'achievement';
  title: string;
  description: string;
  actionable: boolean;
  suggestedAction?: string;
}
```

### 8.4 ëŒ€í™” ë¶„ì„ê¸°

```typescript
// ëŒ€í™” ë¶„ì„ ê²°ê³¼
interface ConversationAnalysis {
  // ê°ì • ë¶„ì„
  sentiment: {
    overall: 'positive' | 'neutral' | 'negative';
    confidence: number;
    emotions: Array<{
      emotion: string;  // happy, tired, frustrated, etc.
      score: number;
    }>;
  };

  // ëŒ€í™” ìŠ¤íƒ€ì¼ ë¶„ì„
  style: {
    avgMessageLength: number;
    emojiFrequency: number;
    responseLatency: number;
    questionFrequency: number;
  };

  // ì£¼ì œ ë¶„ì„
  topics: Array<{
    topic: string;
    frequency: number;
    sentiment: 'positive' | 'neutral' | 'negative';
  }>;

  // ì½”ì¹­ íš¨ê³¼ ë¶„ì„
  coachingEffectiveness: {
    messageType: string;
    studentReaction: 'positive' | 'neutral' | 'negative';
    followUpAction: 'completed' | 'delayed' | 'skipped';
  }[];
}

// ëŒ€í™” ë¶„ì„ê¸° (Gemini 3 Flash ì‚¬ìš©)
const CONVERSATION_ANALYZER_PROMPT = `
ë‹¹ì‹ ì€ í•™ìƒê³¼ ì½”ì¹˜ì˜ ëŒ€í™”ë¥¼ ë¶„ì„í•˜ëŠ” AIì…ë‹ˆë‹¤.

ë‹¤ìŒ ëŒ€í™”ë¥¼ ë¶„ì„í•˜ì—¬ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”:

1. í•™ìƒì˜ ê°ì • ìƒíƒœ
2. ëŒ€í™” ìŠ¤íƒ€ì¼ (ê¸¸ì´, ì´ëª¨ì§€, ë°˜ì‘ ì†ë„)
3. íš¨ê³¼ì ì´ì—ˆë˜ ì½”ì¹­ ë©”ì‹œì§€
4. ê°œì„ ì´ í•„ìš”í•œ ë¶€ë¶„

ë¶„ì„ ê²°ê³¼ëŠ” í•™ìƒ í”„ë¡œíŒŒì¼ ì—…ë°ì´íŠ¸ì— ì‚¬ìš©ë©ë‹ˆë‹¤.
`;
```

### 8.5 ë©”ì‹œì§€ ê°œì¸í™”ê¸°

```typescript
// ë©”ì‹œì§€ ê°œì¸í™” ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
const MESSAGE_PERSONALIZER_PROMPT = `
ë‹¹ì‹ ì€ í•™ìƒ ë§ì¶¤í˜• ë©”ì‹œì§€ë¥¼ ìƒì„±í•˜ëŠ” AIì…ë‹ˆë‹¤.

## í•™ìƒ í”„ë¡œíŒŒì¼
{{studentProfile}}

## ê¸°ë³¸ ë©”ì‹œì§€
{{baseMessage}}

## ìƒí™©
{{context}}

## ê°œì¸í™” ê·œì¹™
1. í•™ìƒì˜ ì„ í˜¸ ë©”ì‹œì§€ ê¸¸ì´ì— ë§ì¶¤: {{preferredLength}}
2. ì´ëª¨ì§€ ì‚¬ìš©ëŸ‰: {{emojiPreference}}
3. ë™ê¸°ë¶€ì—¬ ìœ í˜•: {{motivationType}}
4. í˜„ì¬ ê°ì • ìƒíƒœ ê³ ë ¤: {{lastMood}}

## ì¶œë ¥
í•™ìƒì—ê²Œ ìµœì í™”ëœ ë©”ì‹œì§€ë¥¼ ìƒì„±í•˜ì„¸ìš”.
ê¸°ë³¸ ë©”ì‹œì§€ì˜ í•µì‹¬ ë‚´ìš©ì€ ìœ ì§€í•˜ë˜, í•™ìƒì˜ ì„±í–¥ì— ë§ê²Œ ì¡°ì ˆí•˜ì„¸ìš”.
`;

// ê°œì¸í™” ì˜ˆì‹œ
const personalizationExamples = {
  // ê°™ì€ "ì™„ë£Œ ì¶•í•˜" ë©”ì‹œì§€ë„ í”„ë¡œíŒŒì¼ì— ë”°ë¼ ë‹¤ë¥´ê²Œ
  completion: {
    // í”„ë¡œíŒŒì¼: ì§§ì€ ë©”ì‹œì§€, ì´ëª¨ì§€ ì ìŒ, ì¹­ì°¬í˜•
    short_few_praise: "ì˜í–ˆì–´! ìˆ˜í•™ ì™„ë£Œ.",

    // í”„ë¡œíŒŒì¼: ì¤‘ê°„ ë©”ì‹œì§€, ì´ëª¨ì§€ ë§ìŒ, ëª©í‘œí˜•
    medium_many_goal: "ëŒ€ë‹¨í•´! ğŸ‰ ìˆ˜í•™ ì™„ë£Œ! ì´ì œ ì˜ì–´ë§Œ ë‚¨ì•˜ì–´! ì˜¤ëŠ˜ ëª©í‘œ ê±°ì˜ ë‹¤ ì™”ë‹¤ ğŸ’ªğŸ”¥",

    // í”„ë¡œíŒŒì¼: ê¸´ ë©”ì‹œì§€, ì´ëª¨ì§€ ì•½ê°„, ìŠ¤íŠ¸ë¦­í˜•
    long_some_streak: "ì˜¤ëŠ˜ë„ í•´ëƒˆë„¤! ìˆ˜í•™ ì™„ë£Œ ğŸ‘ ë²Œì¨ 5ì¼ ì—°ì†ì´ì•¼. ì´ í˜ì´ìŠ¤ë©´ ë‹¤ìŒ ì£¼ì— ìˆ˜í•™1 ì™„ì „ ì •ë³µì´ê² ëŠ”ê±¸? ëŒ€ë‹¨í•˜ë‹¤!",
  }
};
```

### 8.6 í•™ìŠµ ì‚¬ì´í´ ìŠ¤ì¼€ì¤„ëŸ¬

```typescript
// í”„ë¡œíŒŒì¼ ì—…ë°ì´íŠ¸ ìŠ¤ì¼€ì¤„
interface ProfileUpdateSchedule {
  // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
  realtime: [
    'lastMood',
    'recentContext',
    'lastInteractionAt'
  ];

  // ì¼ì¼ ì—…ë°ì´íŠ¸ (ë§¤ì¼ ìì •)
  daily: [
    'patterns.temporal',
    'patterns.study',
    'growth.currentStreak'
  ];

  // ì£¼ê°„ ì—…ë°ì´íŠ¸ (ë§¤ì£¼ ì¼ìš”ì¼)
  weekly: [
    'personality',
    'coaching.messageEffectiveness',
    'coaching.optimal',
    'growth.monthlyTrend'
  ];

  // í”Œëœ ì™„ë£Œ ì‹œ ì—…ë°ì´íŠ¸
  onPlanComplete: [
    'growth.completedPlans',
    'growth.subjectProgress',
    'patterns.study.avgCompletionRate'
  ];
}

// í”„ë¡œíŒŒì¼ ì—…ë°ì´íŠ¸ ì‘ì—…
interface ProfileUpdateJob {
  studentId: string;
  updateType: 'realtime' | 'daily' | 'weekly' | 'onEvent';
  fields: string[];
  scheduledAt: Date;
  status: 'pending' | 'running' | 'completed' | 'failed';
}
```

### 8.7 ì•Œë¦¼ ê°œì¸í™”

```typescript
// ê°œì¸í™”ëœ ì•Œë¦¼ ìƒì„±
interface PersonalizedNotification {
  studentId: string;
  type: 'briefing' | 'reminder' | 'celebration' | 'crisis';

  // ê¸°ë³¸ ë©”ì‹œì§€
  baseMessage: string;

  // ê°œì¸í™”ëœ ë©”ì‹œì§€
  personalizedMessage: string;

  // ê°œì¸í™” ì ìš© ë‚´ì—­
  personalization: {
    lengthAdjusted: boolean;
    emojiAdjusted: boolean;
    toneAdjusted: boolean;
    timingOptimized: boolean;
  };

  // ìµœì  ë°œì†¡ ì‹œê°„
  optimalSendTime: Date;

  // ë¹ ë¥¸ ë‹µì¥ ì˜µì…˜ (ê°œì¸í™”)
  quickReplies: string[];
}

// ì•Œë¦¼ ìŠ¤íƒ€ì¼ (ì¹´ì¹´ì˜¤í†¡ ìŠ¤íƒ€ì¼)
interface NotificationStyle {
  senderName: 'ì½”ì¹˜ìŒ¤';
  senderAvatar: 'ğŸ‘¨â€ğŸ“';

  // í•™ìƒ ì´ë¦„ í˜¸ì¹­ (í”„ë¡œíŒŒì¼ì—ì„œ)
  studentNickname: string;  // "ì² ìˆ˜ì•¼", "ì² ìˆ˜", "ê¹€ì² ìˆ˜ í•™ìƒ"

  // ë©”ì‹œì§€ ìŠ¤íƒ€ì¼
  messageStyle: {
    useLineBreaks: boolean;
    bulletPoints: boolean;
    timeEstimates: boolean;
  };
}
```

### 8.8 ë””ë ‰í† ë¦¬ êµ¬ì¡° (ê°œì¸í™” ëª¨ë“ˆ)

```
packages/ai-coach/src/personalization/
â”œâ”€â”€ index.ts                    # ë©”ì¸ export
â”œâ”€â”€ engine.ts                   # PersonalizationEngine êµ¬í˜„
â”œâ”€â”€ profile/
â”‚   â”œâ”€â”€ types.ts               # í”„ë¡œíŒŒì¼ íƒ€ì… ì •ì˜
â”‚   â”œâ”€â”€ repository.ts          # í”„ë¡œíŒŒì¼ ì €ì¥ì†Œ
â”‚   â””â”€â”€ updater.ts             # í”„ë¡œíŒŒì¼ ì—…ë°ì´íŠ¸ ë¡œì§
â”œâ”€â”€ analyzer/
â”‚   â”œâ”€â”€ conversation.ts        # ëŒ€í™” ë¶„ì„ê¸°
â”‚   â”œâ”€â”€ behavior.ts            # í–‰ë™ íŒ¨í„´ ë¶„ì„ê¸°
â”‚   â””â”€â”€ effectiveness.ts       # ì½”ì¹­ íš¨ê³¼ ë¶„ì„ê¸°
â”œâ”€â”€ personalizer/
â”‚   â”œâ”€â”€ message.ts             # ë©”ì‹œì§€ ê°œì¸í™”
â”‚   â”œâ”€â”€ timing.ts              # íƒ€ì´ë° ìµœì í™”
â”‚   â””â”€â”€ notification.ts        # ì•Œë¦¼ ê°œì¸í™”
â”œâ”€â”€ learning/
â”‚   â”œâ”€â”€ scheduler.ts           # í•™ìŠµ ìŠ¤ì¼€ì¤„ëŸ¬
â”‚   â”œâ”€â”€ experiment.ts          # A/B í…ŒìŠ¤íŠ¸ ê´€ë¦¬
â”‚   â””â”€â”€ insights.ts            # ì¸ì‚¬ì´íŠ¸ ìƒì„±
â””â”€â”€ prompts/
    â”œâ”€â”€ analyzer.ts            # ë¶„ì„ìš© í”„ë¡¬í”„íŠ¸
    â””â”€â”€ personalizer.ts        # ê°œì¸í™”ìš© í”„ë¡¬í”„íŠ¸
```

---

## 9. Memory Lane ì‹œìŠ¤í…œ ì„¤ê³„ â­ NEW

### 9.1 ì•„í‚¤í…ì²˜ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ§  Memory Lane Architecture                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Memory     â”‚    â”‚  Vector     â”‚    â”‚  Retrieval  â”‚             â”‚
â”‚  â”‚  Catcher    â”‚ â”€â–¶ â”‚  Storage    â”‚ â”€â–¶ â”‚  Engine     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚        â”‚                  â”‚                  â”‚                      â”‚
â”‚        â–¼                  â–¼                  â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚              ChromaDB (Vector Database)                  â”‚       â”‚
â”‚  â”‚  - 768-dim embeddings                                    â”‚       â”‚
â”‚  â”‚  - 17 metadata fields                                    â”‚       â”‚
â”‚  â”‚  - Cosine similarity search                              â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Mastery    â”‚    â”‚  Burnout    â”‚    â”‚  Spaced     â”‚             â”‚
â”‚  â”‚  Tracker    â”‚    â”‚  Monitor    â”‚    â”‚  Repetition â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 ë°ì´í„° ëª¨ë¸

```typescript
// í•™ìŠµ ê¸°ì–µ ìœ í˜• (12ê°€ì§€)
type MemoryType =
  // í•µì‹¬ ìœ í˜• (6ê°œ)
  | 'CORRECTION'     // êµì •ëœ ë‚´ìš©
  | 'DECISION'       // í•™ìŠµ ê´€ë ¨ ê²°ì •
  | 'INSIGHT'        // ê¹¨ë‹¬ìŒì˜ ìˆœê°„
  | 'PATTERN'        // í–‰ë™ íŒ¨í„´
  | 'GAP'            // ì§€ì‹ ê³µë°±
  | 'LEARNING'       // ì¼ë°˜ í•™ìŠµ (ê¸°ë³¸ê°’)
  // êµìœ¡ í™•ì¥ ìœ í˜• (6ê°œ)
  | 'MASTERY'        // ìˆ™ë‹¬ëœ ê°œë…
  | 'STRUGGLE'       // ì–´ë ¤ì›Œí•˜ëŠ” ë¶€ë¶„
  | 'WRONG_ANSWER'   // í‹€ë¦° ë¬¸ì œ
  | 'STRATEGY'       // ë¬¸ì œ í•´ê²° ì „ëµ
  | 'PREFERENCE'     // í•™ìŠµ ì„ í˜¸ë„
  | 'EMOTION';       // ê°ì • ìƒíƒœ

// í•™ìŠµ ê¸°ì–µ
interface LearningMemory {
  id: string;
  studentId: string;
  type: MemoryType;
  subject: Subject;
  topic: string;
  title: string;
  content: string;

  // í’ˆì§ˆ ë©”íŠ¸ë¦­
  confidence: number;        // 0.6-0.9 (ì¶”ì¶œ ì‹ ë¢°ë„)
  difficulty: number;        // 1-5
  masteryScore: number;      // 0-10 (EMA ê¸°ë°˜)

  // ì¶”ì  ë©”íƒ€ë°ì´í„°
  timesObserved: number;
  recallCount: number;
  positiveFeedback: number;
  negativeFeedback: number;

  // ì‹œê°„ ì •ë³´
  createdAt: Date;
  lastRecalled: Date;
  emotionAtCreation: Emotion;

  // ë²¡í„° (ì €ì¥ ì‹œ ìë™ ìƒì„±)
  embedding?: number[];
}

// í† í”½ ìˆ™ë‹¬ë„ (SM-2)
interface TopicMastery {
  topicId: string;
  studentId: string;
  subject: Subject;
  topicName: string;

  // SM-2 íŒŒë¼ë¯¸í„°
  masteryScore: number;      // 0-10 (EMA)
  easinessFactor: number;    // 1.3-2.5 (ê¸°ë³¸ 2.5)
  interval: number;          // ë³µìŠµ ê°„ê²© (ì¼)
  repetitions: number;       // ë°˜ë³µ íšŸìˆ˜
  nextReviewDate: Date;

  // í•™ìŠµ ê¸°ë¡
  attempts: number;
  correctCount: number;
  lastStudied: Date;
}

// ë²ˆì•„ì›ƒ íŠ¸ë˜ì»¤
interface BurnoutTracker {
  studentId: string;
  level: 'LOW' | 'MEDIUM' | 'HIGH';
  consecutiveNegativeDays: number;
  negativeRatio7Days: number;
  lastPositiveEmotion: Date;

  // ì¼ë³„ ê°ì • ê¸°ë¡ (7ì¼)
  dailyEmotions: Array<{
    date: string;
    emotion: Emotion;
    notes?: string;
  }>;
}
```

### 9.3 Memory Catcher

```typescript
// ê¸°ì–µ ìë™ ì¶”ì¶œê¸°
class LearningMemoryCatcher {
  // ìœ í˜•ë³„ íŠ¸ë¦¬ê±° í‚¤ì›Œë“œ
  private typeKeywords: Record<MemoryType, string[]> = {
    CORRECTION: ["ì•„ë‹ˆ", "ê·¸ê²Œ ì•„ë‹ˆê³ ", "í‹€ë ¸", "ë‹¤ì‹œ"],
    DECISION: ["í•˜ê¸°ë¡œ í–ˆì–´", "ê²°ì •", "ì •í–ˆì–´", "í• ë˜"],
    INSIGHT: ["ì•„!", "ì´í•´í–ˆ", "ì•Œê² ", "ì´ê±°êµ¬ë‚˜", "ê·¸ë ‡êµ¬ë‚˜"],
    PATTERN: ["í•­ìƒ", "ë§¨ë‚ ", "ëŠ˜", "ìŠµê´€ì ìœ¼ë¡œ"],
    GAP: ["ì²˜ìŒ", "ëª¨ë¥´", "ë°°ìš´ ì ", "ë­ì•¼"],
    LEARNING: [],  // ê¸°ë³¸ê°’
    MASTERY: ["ì™„ë²½", "ì‰¬ì›Œ", "ìì‹ ", "ìˆ™ë‹¬"],
    STRUGGLE: ["ì–´ë ¤", "í—·ê°ˆ", "ì´í•´ ì•ˆ", "ë³µì¡"],
    WRONG_ANSWER: [],  // ì˜¤ë‹µ ì‹œ ìë™
    STRATEGY: ["ì´ë ‡ê²Œ í’€", "ë°©ë²•", "ì ‘ê·¼", "ìˆœì„œ"],
    PREFERENCE: ["ì¢‹ì•„", "ì‹«ì–´", "ì„ í˜¸", "í¸í•´"],
    EMOTION: ["ìŠ¤íŠ¸ë ˆìŠ¤", "ê¸°ë¶„", "í”¼ê³¤", "ì‹ ë‚˜", "ì§œì¦"]
  };

  // ê³¼ëª© ê°ì§€ íŒ¨í„´
  private subjectPatterns: Record<Subject, RegExp[]> = {
    math: [/ìˆ˜í•™|í•¨ìˆ˜|ë°©ì •ì‹|ë¯¸ë¶„|ì ë¶„|í™•ë¥ |í†µê³„/],
    korean: [/êµ­ì–´|ë¬¸í•™|ë¹„ë¬¸í•™|ë…í•´|ë¬¸ë²•|í™”ë²•/],
    english: [/ì˜ì–´|ì˜ë¬¸|ë¬¸ë²•|ë…í•´|ë“£ê¸°|ì˜ì‘/],
    science: [/ê³¼í•™|ë¬¼ë¦¬|í™”í•™|ìƒëª…|ì§€êµ¬ê³¼í•™/],
    social: [/ì‚¬íšŒ|ì—­ì‚¬|ì§€ë¦¬|ê²½ì œ|ë²•|ì •ì¹˜/],
    general: [/.*/]
  };

  async extract(
    conversation: Message[],
    studyResult?: StudyRecord,
    currentEmotion?: Emotion
  ): Promise<LearningMemory[]> {
    const memories: LearningMemory[] = [];

    for (const message of conversation) {
      const type = this.detectType(message.content);
      const subject = this.detectSubject(message.content);
      const topic = this.extractTopic(message.content, subject);

      if (type !== 'LEARNING' || this.isSignificant(message)) {
        memories.push({
          id: generateId(),
          studentId: message.studentId,
          type,
          subject,
          topic,
          title: this.generateTitle(message.content),
          content: message.content.slice(0, 500),
          confidence: this.calculateConfidence(type, message),
          difficulty: studyResult?.difficulty || 3,
          masteryScore: 5.0,  // ì´ˆê¸°ê°’
          timesObserved: 1,
          recallCount: 0,
          positiveFeedback: 0,
          negativeFeedback: 0,
          createdAt: new Date(),
          lastRecalled: new Date(),
          emotionAtCreation: currentEmotion || 'NEUTRAL'
        });
      }
    }

    // ì˜¤ë‹µ ì‹œ WRONG_ANSWER ìë™ ì¶”ê°€
    if (studyResult && !studyResult.correct) {
      memories.push(this.createWrongAnswerMemory(studyResult));
    }

    return memories;
  }

  private detectType(content: string): MemoryType {
    for (const [type, keywords] of Object.entries(this.typeKeywords)) {
      if (keywords.some(kw => content.includes(kw))) {
        return type as MemoryType;
      }
    }
    return 'LEARNING';
  }

  private detectSubject(content: string): Subject {
    for (const [subject, patterns] of Object.entries(this.subjectPatterns)) {
      if (patterns.some(p => p.test(content))) {
        return subject as Subject;
      }
    }
    return 'general';
  }

  private calculateConfidence(type: MemoryType, message: Message): number {
    let base = 0.7;
    if (type !== 'LEARNING') base += 0.1;  // ëª…í™•í•œ ìœ í˜•
    if (message.content.length > 50) base += 0.05;  // ì¶©ë¶„í•œ ì»¨í…ìŠ¤íŠ¸
    if (message.metadata?.explicit) base += 0.1;  // ëª…ì‹œì  í‘œí˜„
    return Math.min(0.9, base);
  }
}
```

### 9.4 Query-Aware Retrieval Engine

```typescript
// 6-factor ê°€ì¤‘ì¹˜ ê²€ìƒ‰ ì—”ì§„
class MemoryRetriever {
  private weights = {
    semanticSimilarity: 0.45,
    recency: 0.10,
    confidence: 0.10,
    typeBoost: 0.15,
    subjectMatch: 0.10,
    urgencyBoost: 0.10
  };

  // ìœ í˜• ë¶€ìŠ¤íŠ¸ í‚¤ì›Œë“œ
  private typeBoostKeywords: Record<string, MemoryType[]> = {
    "ì‹¤ìˆ˜|í‹€ë ¸": ['CORRECTION', 'WRONG_ANSWER'],
    "ì˜¤ë‹µ|í‹€ë¦° ë¬¸ì œ": ['WRONG_ANSWER'],
    "ì™„ë²½|ìˆ™ë‹¬": ['MASTERY'],
    "ì–´ë µ|í—·ê°ˆ": ['STRUGGLE', 'GAP'],
    "í’€ì´ë²•|ì ‘ê·¼": ['STRATEGY'],
    "ìŠ¤íŠ¸ë ˆìŠ¤|í˜ë“¤": ['EMOTION'],
    "ì²˜ìŒ|ìƒˆë¡œìš´": ['GAP']
  };

  async search(
    query: string,
    studentId: string,
    context: SearchContext
  ): Promise<ScoredMemory[]> {
    // 1. ë²¡í„° ê²€ìƒ‰ (top-50)
    const candidates = await this.vectorSearch(query, 50);

    // 2. Re-ranking
    const scored = candidates.map(memory => ({
      memory,
      score: this.calculateScore(memory, query, context)
    }));

    // 3. ì •ë ¬ ë° ë°˜í™˜
    return scored
      .sort((a, b) => b.score - a.score)
      .slice(0, context.topK || 5);
  }

  private calculateScore(
    memory: LearningMemory,
    query: string,
    context: SearchContext
  ): number {
    let score = 0;

    // 1. ì‹œë§¨í‹± ìœ ì‚¬ë„ (45%)
    score += memory.similarityScore * this.weights.semanticSimilarity;

    // 2. ìµœê·¼ì„± (10%) - 7ì¼ ê°ì‡ 
    const daysSince = differenceInDays(new Date(), memory.lastRecalled);
    const recencyScore = Math.exp(-daysSince / 7);
    score += recencyScore * this.weights.recency;

    // 3. ì‹ ë¢°ë„ (10%)
    score += memory.confidence * this.weights.confidence;

    // 4. ìœ í˜• ë¶€ìŠ¤íŠ¸ (15%)
    const typeBoost = this.calculateTypeBoost(query, memory.type);
    score += typeBoost * this.weights.typeBoost;

    // 5. ê³¼ëª© ë§¤ì¹­ (10%)
    if (memory.subject === context.currentSubject) {
      score += 1.0 * this.weights.subjectMatch;
    }

    // 6. D-Day ê¸´ê¸‰ë„ (10%)
    const urgencyBoost = this.calculateUrgencyBoost(context.dDay, memory.subject);
    score += urgencyBoost * this.weights.urgencyBoost;

    return score;
  }

  private calculateTypeBoost(query: string, memoryType: MemoryType): number {
    for (const [pattern, types] of Object.entries(this.typeBoostKeywords)) {
      if (new RegExp(pattern).test(query) && types.includes(memoryType)) {
        return 1.0;
      }
    }
    return 0.3;  // ê¸°ë³¸ ë¶€ìŠ¤íŠ¸
  }

  private calculateUrgencyBoost(dDay: number | undefined, subject: Subject): number {
    if (!dDay) return 0.05;

    let base = 0.05;
    if (dDay <= 7) base = 0.30;
    else if (dDay <= 30) base = 0.20;
    else if (dDay <= 100) base = 0.10;

    if (subject === 'math') base += 0.05;
    return base;
  }
}
```

### 9.5 SM-2 Spaced Repetition

```typescript
// SM-2 ê°„ê²© ë°˜ë³µ í•™ìŠµ ê´€ë¦¬ì
class SpacedRepetitionManager {
  private readonly MIN_EF = 1.3;
  private readonly MAX_INTERVAL = 30;

  // SM-2 ì•Œê³ ë¦¬ì¦˜ ì—…ë°ì´íŠ¸
  updateMastery(topic: TopicMastery, quality: number): TopicMastery {
    // quality: 0-5 (0=ì™„ì „ì‹¤íŒ¨, 5=ì™„ë²½)

    if (quality < 3) {
      // ì‹¤íŒ¨: ì²˜ìŒë¶€í„°
      topic.repetitions = 0;
      topic.interval = 1;
    } else {
      // ì„±ê³µ: ê°„ê²© í™•ì¥
      if (topic.repetitions === 0) {
        topic.interval = 1;
      } else if (topic.repetitions === 1) {
        topic.interval = 6;
      } else {
        topic.interval = Math.min(
          this.MAX_INTERVAL,
          Math.round(topic.interval * topic.easinessFactor)
        );
      }
      topic.repetitions++;
    }

    // EF ì¡°ì •
    topic.easinessFactor = Math.max(
      this.MIN_EF,
      topic.easinessFactor + 0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02)
    );

    // ë‹¤ìŒ ë³µìŠµì¼ ì„¤ì •
    topic.nextReviewDate = addDays(new Date(), topic.interval);

    // EMA ê¸°ë°˜ ìˆ™ë‹¬ë„ ì—…ë°ì´íŠ¸
    const newScore = quality * 2;  // 0-10 ìŠ¤ì¼€ì¼ ë³€í™˜
    topic.masteryScore = this.updateEMA(topic.masteryScore, newScore);

    return topic;
  }

  private updateEMA(current: number, newValue: number): number {
    const alpha = 0.3;
    return alpha * newValue + (1 - alpha) * current;
  }

  // ì˜¤ëŠ˜ ë³µìŠµí•´ì•¼ í•  í† í”½ ì¡°íšŒ
  async getDueReviews(studentId: string): Promise<TopicMastery[]> {
    const topics = await this.topicRepository.findByStudent(studentId);
    const today = startOfDay(new Date());

    return topics
      .filter(t => t.nextReviewDate <= today)
      .sort((a, b) => a.masteryScore - b.masteryScore);  // ì·¨ì•½ í† í”½ ìš°ì„ 
  }

  // ìˆ™ë‹¬ ë ˆë²¨ íŒì •
  getMasteryLevel(score: number): MasteryLevel {
    if (score >= 8.0) return 'EXPERT';
    if (score >= 6.0) return 'ADVANCED';
    if (score >= 4.0) return 'INTERMEDIATE';
    return 'BEGINNER';
  }
}
```

### 9.6 Burnout Monitor

```typescript
// ë²ˆì•„ì›ƒ ëª¨ë‹ˆí„°
class BurnoutMonitor {
  private emotionKeywords: Record<Emotion, string[]> = {
    STRESSED: ["ìŠ¤íŠ¸ë ˆìŠ¤", "í˜ë“¤", "ì§€ì³", "í¬ê¸°", "ì‹«ì–´"],
    ANXIOUS: ["ë¶ˆì•ˆ", "ê±±ì •", "ê¸´ì¥", "ë¬´ì„œì›Œ"],
    FRUSTRATED: ["ì§œì¦", "í™”ë‚˜", "ì—´ë°›", "ì•ˆ í’€ë ¤"],
    TIRED: ["ì¡¸ë ¤", "í”¼ê³¤", "ì‰¬ê³ ì‹¶"],
    MOTIVATED: ["í™”ì´íŒ…", "ì—´ì‹¬íˆ", "í•  ìˆ˜ ìˆì–´"],
    CONFIDENT: ["ìì‹ ", "ì˜í• ", "ì‰¬ì›Œ", "ì™„ë²½"],
    NEUTRAL: []
  };

  private copingStrategies: Record<Emotion, string[]> = {
    STRESSED: [
      "4-7-8 í˜¸í¡ë²• (4ì´ˆ ë“¤ì´ì‰¬ê³ , 7ì´ˆ ì°¸ê³ , 8ì´ˆ ë‚´ì‰¬ê¸°)",
      "10ë¶„ ì‚°ì±…í•˜ê³  ì˜¤ê¸°",
      "ì¢‹ì•„í•˜ëŠ” ìŒì•… í•œ ê³¡ ë“£ê¸°",
      "ë”°ëœ»í•œ ì°¨ í•œ ì” ë§ˆì‹œê¸°"
    ],
    ANXIOUS: [
      "ì§€ê¸ˆ í•  ìˆ˜ ìˆëŠ” ë”± í•˜ë‚˜ì—ë§Œ ì§‘ì¤‘í•˜ê¸°",
      "ê±±ì • ì¼ê¸° ì¨ë³´ê¸°",
      "ì˜ˆì „ì— ì˜ í•´ë‚¸ ê²½í—˜ ë– ì˜¬ë¦¬ê¸°",
      "ì¹œêµ¬ë‚˜ ê°€ì¡±ê³¼ ì´ì•¼ê¸°í•˜ê¸°"
    ],
    FRUSTRATED: [
      "5ë¶„ ì‰¬ê³  ëŒì•„ì˜¤ê¸°",
      "ë‹¤ë¥¸ ê³¼ëª©ìœ¼ë¡œ ë°”ê¿”ë³´ê¸°",
      "ì–´ë ¤ìš´ ë¶€ë¶„ ë©”ëª¨í•˜ê³  ë‚˜ì¤‘ì— ë‹¤ì‹œ ë³´ê¸°",
      "ìŠ¤íŠ¸ë ˆì¹­í•˜ê¸°"
    ],
    TIRED: [
      "15ë¶„ íŒŒì›Œ ëƒ… ìê¸°",
      "ë¬¼ í•œ ì” ë§ˆì‹œê¸°",
      "ì°½ë¬¸ ì—´ì–´ í™˜ê¸°í•˜ê¸°",
      "ëˆˆ ê°ê³  1ë¶„ íœ´ì‹"
    ]
  };

  // ê°ì • ê°ì§€
  detectEmotion(message: string): Emotion {
    for (const [emotion, keywords] of Object.entries(this.emotionKeywords)) {
      if (keywords.some(kw => message.includes(kw))) {
        return emotion as Emotion;
      }
    }
    return 'NEUTRAL';
  }

  // ë²ˆì•„ì›ƒ ë ˆë²¨ í‰ê°€
  assessBurnout(tracker: BurnoutTracker): 'LOW' | 'MEDIUM' | 'HIGH' {
    if (tracker.consecutiveNegativeDays >= 5 || tracker.negativeRatio7Days > 0.7) {
      return 'HIGH';
    }
    if (tracker.consecutiveNegativeDays >= 3 || tracker.negativeRatio7Days > 0.5) {
      return 'MEDIUM';
    }
    return 'LOW';
  }

  // ëŒ€ì²˜ ì „ëµ ì¶”ì²œ
  getCopingStrategy(emotion: Emotion): string {
    const strategies = this.copingStrategies[emotion];
    if (!strategies?.length) return "";
    return strategies[Math.floor(Math.random() * strategies.length)];
  }

  // ë™ê¸°ë¶€ì—¬ ë©”ì‹œì§€
  getMotivationMessage(): string {
    const messages = [
      "ì¡°ê¸ˆì”© ì•ìœ¼ë¡œ ë‚˜ì•„ê°€ê³  ìˆì–´ìš” ğŸ’ª",
      "í¬ê¸°í•˜ì§€ ì•ŠëŠ” ê²ƒë§Œìœ¼ë¡œë„ ëŒ€ë‹¨í•´ìš”",
      "ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ê´œì°®ì•„ìš”",
      "í˜ë“  ì‹œê°„ë„ ì§€ë‚˜ê°€ìš”",
      "í•œ ë¬¸ì œ í•œ ë¬¸ì œê°€ ëª¨ì—¬ ì‹¤ë ¥ì´ ë¼ìš”",
      "ë‹¹ì‹ ì˜ ë…¸ë ¥ì€ ë¶„ëª… ê²°ì‹¤ì„ ë§ºì„ ê±°ì˜ˆìš”",
      "ì†ë„ë³´ë‹¤ ë°©í–¥ì´ ì¤‘ìš”í•´ìš”",
      "ì§€ê¸ˆ ì´ ìˆœê°„ì„ ì¹­ì°¬í•´ì£¼ì„¸ìš”"
    ];
    return messages[Math.floor(Math.random() * messages.length)];
  }
}
```

### 9.7 LLM Context Injection

```typescript
// ê´€ë ¨ ê¸°ì–µì„ LLM í”„ë¡¬í”„íŠ¸ì— ì£¼ì…
class MemoryContextInjector {
  async injectContext(
    basePrompt: string,
    studentId: string,
    query: string,
    context: MessageContext
  ): Promise<string> {
    // 1. ê´€ë ¨ ê¸°ì–µ ê²€ìƒ‰
    const memories = await this.retriever.search(query, studentId, {
      topK: 3,
      currentSubject: context.subject,
      dDay: context.dDay
    });

    if (!memories.length) {
      return basePrompt;
    }

    // 2. ê¸°ì–µ ì»¨í…ìŠ¤íŠ¸ ìƒì„±
    const memoryContext = memories.map(({ memory }) =>
      `- [${memory.type}] ${memory.title} (${memory.subject})`
    ).join('\n');

    // 3. í”„ë¡¬í”„íŠ¸ì— ì£¼ì…
    return `${basePrompt}

## ê´€ë ¨ í•™ìŠµ ê¸°ë¡
í•™ìƒì˜ ê³¼ê±° í•™ìŠµì—ì„œ ë°œê²¬ëœ ê´€ë ¨ ê¸°ë¡ì…ë‹ˆë‹¤:
${memoryContext}

ì´ ê¸°ë¡ì„ ì°¸ê³ í•˜ì—¬ í•™ìƒì—ê²Œ ë§ì¶¤í™”ëœ ì‘ë‹µì„ ìƒì„±í•˜ì„¸ìš”.
íŠ¹íˆ STRUGGLE ìœ í˜•ì˜ ê¸°ë¡ì´ ìˆë‹¤ë©´ í•´ë‹¹ ë¶€ë¶„ì„ ë” ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”.
MASTERY ìœ í˜•ì´ ìˆë‹¤ë©´ ë³µìŠµì€ ê°„ë‹¨íˆ ë„˜ì–´ê°€ë„ ë©ë‹ˆë‹¤.`;
  }
}
```

### 9.8 ë””ë ‰í† ë¦¬ êµ¬ì¡° (Memory Lane ëª¨ë“ˆ)

```
packages/ai-coach/src/memory-lane/
â”œâ”€â”€ index.ts                    # ë©”ì¸ export
â”œâ”€â”€ types.ts                    # íƒ€ì… ì •ì˜
â”œâ”€â”€ catcher/
â”‚   â”œâ”€â”€ index.ts               # LearningMemoryCatcher
â”‚   â”œâ”€â”€ type-detector.ts       # ìœ í˜• ê°ì§€
â”‚   â”œâ”€â”€ subject-detector.ts    # ê³¼ëª© ê°ì§€
â”‚   â””â”€â”€ topic-extractor.ts     # í† í”½ ì¶”ì¶œ
â”œâ”€â”€ storage/
â”‚   â”œâ”€â”€ chromadb-client.ts     # ChromaDB í´ë¼ì´ì–¸íŠ¸
â”‚   â”œâ”€â”€ memory-repository.ts   # ê¸°ì–µ ì €ì¥ì†Œ
â”‚   â””â”€â”€ embedding-service.ts   # ì„ë² ë”© ì„œë¹„ìŠ¤
â”œâ”€â”€ retrieval/
â”‚   â”œâ”€â”€ retriever.ts           # Query-Aware ê²€ìƒ‰
â”‚   â”œâ”€â”€ reranker.ts            # 6-factor Re-Ranking
â”‚   â””â”€â”€ scorer.ts              # ì ìˆ˜ ê³„ì‚°
â”œâ”€â”€ mastery/
â”‚   â”œâ”€â”€ sm2-algorithm.ts       # SM-2 ì•Œê³ ë¦¬ì¦˜
â”‚   â”œâ”€â”€ topic-tracker.ts       # í† í”½ë³„ ìˆ™ë‹¬ë„ ì¶”ì 
â”‚   â””â”€â”€ review-scheduler.ts    # ë³µìŠµ ìŠ¤ì¼€ì¤„ëŸ¬
â”œâ”€â”€ monitor/
â”‚   â”œâ”€â”€ burnout-tracker.ts     # ë²ˆì•„ì›ƒ ê°ì§€
â”‚   â”œâ”€â”€ emotion-detector.ts    # ê°ì • ê°ì§€
â”‚   â””â”€â”€ coping-strategies.ts   # ëŒ€ì²˜ ì „ëµ
â””â”€â”€ injection/
    â”œâ”€â”€ context-injector.ts    # LLM ì»¨í…ìŠ¤íŠ¸ ì£¼ì…
    â””â”€â”€ prompt-builder.ts      # í”„ë¡¬í”„íŠ¸ ë¹Œë”
```
