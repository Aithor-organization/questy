# AI 학습 코칭 시스템 - 요구사항 명세서 v2

## 1. 프로젝트 개요

### 1.1 비전
**"진짜 학원처럼 관리해주는 AI 학습 코치"**

학원의 체계적인 관리 시스템을 AI로 구현하여, 혼자 공부하는 학생도 학원에 다니는 것처럼 밀착 관리를 받을 수 있도록 한다. **입학 상담부터 무한한 성장까지** 현실 학원의 모든 과정을 재현한다.

### 1.1.1 무한 성장 루프 (No Graduation Loop)

**핵심 철학**: "졸업"은 성취감을 주는 축하 이벤트이지만, 실제로 학생이 앱을 떠나는 종료점이 아니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                   ♾️ 무한 성장 루프                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   플랜 완료! 🎉                                                  │
│       │                                                         │
│       ▼                                                         │
│   수료 축하 + 성취 리포트                                        │
│       │                                                         │
│       ▼                                                         │
│   "다음 목표는 뭐야?" → 새 플랜 추천                              │
│       │                                                         │
│       ▼                                                         │
│   새 플랜 시작 → (반복)                                          │
│                                                                 │
│   💡 졸업은 "개념"으로만 존재, 실제 종료점 없음                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2 학원 구조 모방 컨셉

```
┌─────────────────────────────────────────────────────────────────┐
│                      🏫 AI 학원 시스템                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   👨‍💼 원장 (Director)            = 오케스트레이터                 │
│   └─ 전체 운영 총괄, 학생 배정, 의사결정                           │
│                                                                 │
│   🎓 입학 상담사 (Admission)      = 입학 Agent        ⭐ NEW      │
│   └─ 입학 상담, 레벨 테스트, 반 배정, 오리엔테이션                  │
│                                                                 │
│   👩‍🏫 커리큘럼 설계사 (Planner)    = 플래너 Agent                 │
│   └─ 교재 분석, 학습 계획 수립, 진도 조정                          │
│                                                                 │
│   👨‍🎓 담임 선생님 (Coach)         = 코치 Agent                   │
│   └─ 매일 학생 관리, 동기부여, 상담                               │
│                                                                 │
│   📊 학습 분석관 (Analyst)        = 분석가 Agent                  │
│   └─ 성적 분석, 학습 패턴 파악, 리포트 작성                        │
│                                                                 │
│   🗄️ 학생부 (Registry)           = 공유 메모리                   │
│   └─ 학생 정보, 학습 기록, 상담 기록 보관                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 1.3 학생 여정 (Student Journey) - 무한 루프

```
┌─────────────────────────────────────────────────────────────────┐
│                     🎒 학생 여정 (무한 성장 루프)                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1️⃣ 입학 상담     "안녕! 어떤 공부를 하고 싶어?"                   │
│      │            목표, 현재 상황, 고민 파악                       │
│      ▼                                                          │
│  2️⃣ 레벨 테스트   "지금 실력을 간단히 확인해볼까?"                 │
│      │            현재 수준, 취약점 파악                          │
│      ▼                                                          │
│  3️⃣ 반 배정      "너한테 맞는 플랜을 추천해줄게!"                  │
│      │            학습 강도, 기간, 스타일 결정                     │
│      ▼                                                          │
│  4️⃣ 오리엔테이션  "우리 학원은 이렇게 운영돼"                      │
│      │            시스템 안내, 담임 소개, 규칙 설명                 │
│      ▼                                                          │
│  5️⃣ 수업        "자, 이제 첫 퀘스트 시작이야!"                    │
│      │            일일 학습, 코칭, 관리                           │
│      ▼                                                          │
│  6️⃣ 수료 축하    "목표 달성! 정말 대단해! 🎉"                     │
│      │            성취 리포트, 배지 수여                          │
│      ▼                                                          │
│  7️⃣ 다음 여정    "다음 목표는 뭐야?"  ──────────────┐             │
│                  새 교재 추천, 다음 플랜 유도          │             │
│                                                     │             │
│      ┌──────────────────────────────────────────────┘             │
│      │                                                            │
│      └────────────▶ 3️⃣ 반 배정 (새 플랜) ◀── 무한 반복            │
│                                                                 │
│  💡 학생은 "졸업"이 아닌 "다음 레벨"로 계속 성장                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 1.4 목표 사용자
- **주 타겟**: 중고등학생 (자기주도 학습 필요)
- **보조 타겟**: 학부모 (자녀 학습 현황 파악)

### 1.5 다중 플랜 관리 (Multi-Plan)

**핵심**: 학생은 여러 교재/과목을 **동시에** 진행할 수 있다.

```
┌─────────────────────────────────────────────────────────────────┐
│                    📚 다중 플랜 시스템                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   학생: 김철수                                                   │
│   ├── 📘 플랜 1: 수학1 (14일) ████████░░ 60%                    │
│   ├── 📗 플랜 2: 영어   (21일) ███░░░░░░░ 30%                    │
│   └── 📙 플랜 3: 과학   (7일)  █████████░ 90%                    │
│                                                                 │
│   🌅 아침 브리핑:                                                │
│   "오늘은 수학 2단원, 영어 3과, 과학 마지막 단원이야!"             │
│                                                                 │
│   ✅ 완료 처리: 과목별 개별 완료                                   │
│   📊 리포트: 과목별 + 전체 통합 리포트                            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**운영 규칙**:
- 플랜 추가: 언제든 새 교재 등록 가능
- 플랜 수료: 각 플랜별로 개별 수료 + 배지
- 아침 브리핑: 오늘의 모든 퀘스트 통합 안내
- 위기 감지: 전체 미학습 3일 기준 (과목별 아님)

---

## 2. LLM 전략

### 2.1 모델 선택 원칙

| 우선순위 | 기준 | 설명 |
|----------|------|------|
| 1 | **실시간성** | 대화는 빠른 응답이 핵심 |
| 2 | **비용 효율** | 잦은 호출에도 비용 부담 적음 |
| 3 | **품질** | 중요한 작업은 고품질 모델 |

### 2.2 모델별 역할 배정

```
┌─────────────────────────────────────────────────────────────────┐
│                      🧠 LLM 전략                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ⚡ 경량 모델 (실시간 대화)                                       │
│  ├─ Claude 4.5 Haiku     → 일상 코칭 대화, 체크인, 격려           │
│  └─ GPT-5 Nano          → 의도 분류, 간단한 응답                 │
│                                                                 │
│  🔥 고성능 모델 (중요 작업)                                       │
│  └─ Gemini 3 Flash       → 플랜 생성, 분석, 입학 상담             │
│                          → Vision (목차 분석)                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.3 Agent별 모델 매핑

| Agent | 주 모델 | 보조 모델 | 이유 |
|-------|---------|-----------|------|
| **Director** | GPT-5 Nano | - | 의도 분류는 빠르게 |
| **Admission** | Gemini 3 Flash | Claude Haiku | 첫인상 중요, 심층 상담 |
| **Planner** | Gemini 3 Flash | - | Vision + 복잡한 분석 |
| **Coach** | Claude 4.5 Haiku | Gemini Flash | 실시간 대화, 위기시 업그레이드 |
| **Analyst** | Gemini 3 Flash | - | 데이터 분석, 리포트 |

### 2.4 동적 모델 스위칭

```typescript
// 상황에 따라 모델 업그레이드
function selectModel(context: Context): Model {
  // 위기 상황 → 고성능 모델
  if (context.isCrisis) return 'gemini-3-flash';

  // 복잡한 질문 → 고성능 모델
  if (context.complexity > 0.7) return 'gemini-3-flash';

  // 일반 대화 → 경량 모델
  return 'claude-4.5-haiku';
}
```

---

## 3. 기능 요구사항

### 3.1 원장 (Orchestrator)

#### FR-001: 요청 의도 분류
- 사용자 입력을 분석하여 적절한 Agent에 라우팅
- **GPT-5 Nano로 빠른 분류** (< 500ms)
- 의도가 불분명할 경우 확인 질문 생성

#### FR-002: 멀티 Agent 조율
- 복합 요청 시 여러 Agent 순차/병렬 호출
- Agent 간 결과 종합하여 최종 응답 생성

#### FR-003: 시간 기반 자동 트리거
- 설정된 시간에 자동으로 브리핑/알림 발송
- 학습 시작 시간, 저녁 리뷰 등 스케줄 관리

### 3.2 입학 상담사 (Admission Agent) ⭐ NEW

#### FR-050: 입학 상담
- 첫 방문 학생 환영 인사
- 학습 목표 파악 (시험 준비? 내신? 선행?)
- 현재 고민/어려움 청취
- 사용 가능한 시간 확인

```
상담사: "안녕! 반가워 😊
        어떤 공부를 도와줄까?
        시험 준비야, 아니면 평소 공부?"
```

#### FR-051: 레벨 테스트 (간이)
- 현재 학습 진도 확인
- 자가 평가 질문 (1-5점)
- 취약 영역 파악

```
상담사: "지금 어디까지 공부했어?
        수학은 어느 정도 자신 있어? (1-5점)"
```

#### FR-052: 반 배정 (플랜 추천)
- 상담 결과 기반 학습 강도 추천
- 3가지 옵션 제시 (여유/보통/빡빡)
- 학생 선택 반영

```
상담사: "너한테 맞는 플랜을 추천해줄게!
        1. 여유롭게 (하루 30분)
        2. 보통 (하루 45분)  ← 추천!
        3. 빡빡하게 (하루 60분)"
```

#### FR-053: 오리엔테이션
- 학원 시스템 소개
- 담임 선생님 소개
- 알림 시간 설정
- 첫 퀘스트 예고

```
상담사: "좋아! 이제 우리 학원 멤버야! 🎉

        📌 우리 학원은 이렇게 운영돼:
        • 매일 아침 담임쌤이 오늘 할 일 알려줘
        • 공부 끝나면 완료 버튼 누르면 돼
        • 어려우면 언제든 물어봐!

        담임 선생님은 '코치쌤'이야.
        내일 아침 7시에 첫 인사할게!"
```

#### FR-054: 입학 완료 처리
- 학생 프로필 생성
- 초기 설정 저장
- 담임 Agent에 인수인계

### 3.3 커리큘럼 설계사 (Planner Agent)

#### FR-010: 목차 이미지 분석
- 교재 목차 사진을 **Gemini 3 Flash Vision**으로 분석
- 단원 구조, 페이지 범위, 학습 내용 추출

#### FR-011: 학습 플랜 생성
- 목표 기간에 맞춘 일일 퀘스트 분배
- 단원별 예상 학습 시간 산정
- 난이도 기반 균형 배분

#### FR-012: 플랜 품질 리뷰
- 생성된 플랜의 실현 가능성 평가
- 밸런스 분석 (시간/난이도/분량)
- 개선 제안 생성

#### FR-013: 플랜 재조정
- 기존 분석 결과 활용한 빠른 재생성
- 다른 일수/강도로 플랜 변환

### 3.4 담임 선생님 (Coach Agent)

#### FR-020: 아침 브리핑 (다중 플랜 지원)
- **모든 활성 플랜의 오늘 퀘스트 통합 안내**
- 어제 학습 결과 피드백 (과목별)
- 개인화된 동기부여 메시지
- **Claude 4.5 Haiku로 자연스럽게**

```
코치: "좋은 아침! ☀️ 오늘 일정이야:
      📘 수학: 2단원 이차함수 (30분)
      📗 영어: 3과 문법 (20분)
      총 50분이면 끝나! 화이팅!"
```

#### FR-021: 학습 시작 유도
- 설정 시간에 학습 시작 알림
- 미시작 시 15분/30분 후 재알림
- "지금 시작하면 N시에 끝나요" 구체적 안내

#### FR-022: 학습 중 체크인
- 학습 시작 후 일정 시간 경과 시 진행 확인
- 어려운 부분 있는지 질문
- 휴식 시간 권유 (포모도로)

#### FR-023: 학습 완료 처리 (다중 플랜 지원)
- **과목별** 완료 보고 접수 및 기록
- 체감 난이도/이해도 수집 (1-5점)
- 칭찬 및 격려 메시지
- 남은 오늘 퀘스트 안내 (다른 과목)

```
학생: "수학 끝났어!"
코치: "대단해! 🎉 수학 완료!
      아직 영어 3과가 남았어. 잠깐 쉬고 할까?"
```

#### FR-024: 미학습 대응
- 공감적 메시지 ("힘들었구나")
- 일정 재조정 제안
- "오늘 30분만 해볼까?" 협상
- 절대 비난/강압 금지

#### FR-025: 저녁 리뷰
- 오늘 학습 요약
- 달성률 피드백
- 내일 예고
- 스트릭 현황

#### FR-026: 위기 개입
- 연속 3일 미학습 감지
- **Gemini 3 Flash로 업그레이드** (중요한 상황)
- 특별 공감 메시지
- 플랜 축소 제안
- 다시 시작할 수 있는 작은 목표 제시

### 3.5 학습 분석관 (Analyst Agent)

#### FR-030: 주간 분석 리포트
- 이번 주 학습 요약
- 달성률 및 트렌드
- 학습 패턴 분석 (집중 시간대 등)
- 다음 주 제안

#### FR-031: 학습 패턴 분석
- 언제 가장 집중을 잘 하는지
- 어떤 과목/단원이 어려운지
- 평균 학습 시간 vs 계획 시간

#### FR-032: 진행률 통계 (다중 플랜 지원)
- **플랜별** 진행률 + 전체 통합 진행률
- 각 플랜별 남은 일수 및 예상 완료일
- 현재 페이스 평가 (과목별)

#### FR-033: 학부모 리포트 (선택)
- 학부모용 요약 리포트
- 자녀 학습 현황
- 관심 필요 영역 안내

#### FR-034: 수료 축하 및 다음 플랜 유도 ⭐ UPDATED
- 플랜 완료 시 성취 축하 및 리포트
- 학습 여정 요약 + 배지/스티커 수여
- **즉시 다음 플랜 추천** (필수)
- "다음 목표는 뭐야?" 대화로 자연스럽게 연결
- 새 교재 추천 또는 심화 학습 제안

```
분석가: "와, 정말 대단해! 🎉
        [수학1] 완전 정복!

        📊 너의 여정:
        • 총 14일 플랜 완료
        • 평균 달성률 92%
        • 최장 스트릭 7일 🔥

        🏆 '수학 마스터' 배지 획득!

        자, 다음 목표는 뭐야?
        1. 수학2 도전하기
        2. 다른 과목 시작하기
        3. 잠시 쉬고 나중에 정하기"
```

### 3.6 학생부 (Shared Memory)

#### FR-040: 학생 프로필 관리
- 기본 정보 (이름, 학년, 목표)
- 선호 설정 (학습 시간, 코칭 스타일)
- 코칭 히스토리
- **입학 상담 결과** ⭐ NEW

#### FR-041: 학습 플랜 저장
- 현재 진행 중인 플랜
- 플랜 생성 이력
- 플랜 수정 이력

#### FR-042: 학습 기록 관리
- 일별 학습 완료 여부
- 실제 학습 시간
- 체감 난이도/이해도
- 연속 학습일 (스트릭)

#### FR-043: 대화 컨텍스트 유지
- 최근 대화 기록
- 중요 상담 내용 하이라이트
- Agent 간 공유 컨텍스트

---

## 4. 비기능 요구사항

### 4.1 성능
- **NFR-001**: 일반 대화 응답 **1초 이내** (경량 모델)
- **NFR-002**: 플랜 생성 30초 이내
- **NFR-003**: 동시 사용자 1000명 지원

### 4.2 가용성
- **NFR-010**: 99.5% 업타임
- **NFR-011**: 트리거 알림 지연 최대 1분

### 4.3 보안
- **NFR-020**: 학생 개인정보 암호화 저장
- **NFR-021**: API 인증 필수

### 4.4 확장성
- **NFR-030**: 새로운 Agent 추가 용이
- **NFR-031**: 과목별 특화 Agent 확장 가능

### 4.5 비용 효율 ⭐ NEW
- **NFR-040**: 일상 대화는 경량 모델 사용
- **NFR-041**: 모델 사용량 모니터링
- **NFR-042**: 월 비용 예측 대시보드

---

## 5. 인터페이스 요구사항

### 5.1 입력 인터페이스
| 입력 | 처리 Agent | 형식 |
|------|------------|------|
| 첫 방문 | 입학 상담사 | 자연어 |
| 목차 이미지 | 플래너 | Base64 이미지 |
| 텍스트 대화 | 코치 | 자연어 |
| 완료 보고 | 코치 | 버튼/텍스트 |
| 난이도 평가 | 코치 | 1-5 숫자 |

### 5.2 출력 인터페이스
| 출력 | 생성 Agent | 형식 |
|------|------------|------|
| 입학 안내 | 입학 상담사 | 텍스트 + 버튼 |
| 학습 플랜 | 플래너 | JSON + 설명 |
| 코칭 메시지 | 코치 | 텍스트 |
| 분석 리포트 | 분석가 | JSON + 시각화 데이터 |
| 푸시 알림 | 오케스트레이터 | 짧은 텍스트 |

---

## 6. 제약사항

### 6.1 기술 제약
- LLM 경량: Claude 4.5 Haiku, GPT-5 Nano
- LLM 고성능: Gemini 3 Flash (Vision 포함)
- 메모리: 인메모리 → PostgreSQL 확장

### 6.2 비즈니스 제약
- MVP 기간: 4주
- 초기 타겟: 개인 학생 (B2C)

---

## 7. 용어 정의

| 용어 | 정의 |
|------|------|
| 입학 | 신규 학생의 첫 온보딩 과정 |
| 반 배정 | 학습 강도/스타일 결정 |
| 오리엔테이션 | 시스템 사용법 안내 |
| 퀘스트 | 하루치 학습 단위 |
| 플랜 | 전체 학습 계획 (퀘스트의 집합) |
| 스트릭 | 연속 학습 일수 |
| 브리핑 | 아침 학습 안내 메시지 |
| 체크인 | 학습 중 진행 확인 |
| 수료 | 플랜 완료 축하 이벤트 (앱 종료점 아님) |
| 다음 여정 | 수료 후 새 플랜 시작 유도 |

### 7.1 "졸업 없음" 원칙

**핵심**: 학생은 "졸업"하지 않고 "레벨업"한다.

- ❌ "졸업했습니다. 앱을 떠나세요"
- ✅ "수료 축하! 다음 목표는 뭐야?"

학생이 플랜을 완료하면:
1. 성취감을 충분히 축하
2. 배지/스티커 등 리워드 제공
3. **즉시 다음 플랜 추천** (필수)
4. "쉬고 싶으면 나중에 알려줘" (이탈 방지)

---

## 8. 부록: 메시지 톤앤매너 가이드

### 8.1 Agent별 말투

| Agent | 페르소나 | 말투 예시 |
|-------|----------|-----------|
| 입학 상담사 | 친절한 상담사 | "안녕! 반가워 😊" |
| 플래너 | 전문 설계사 | "분석 결과, 14일 플랜을 추천해요" |
| 코치 | 따뜻한 담임 | "오늘도 화이팅이야!" |
| 분석가 | 객관적 분석관 | "이번 주 달성률은 85%입니다" |

### 8.2 코치 Agent 말투 규칙

```
✅ DO (권장)
- "오늘도 화이팅이야!" (친근함)
- "어려웠겠다, 수고했어" (공감)
- "30분만 해볼까?" (협상)
- "대단해! 벌써 3일째야" (칭찬)

❌ DON'T (금지)
- "왜 안 했어?" (비난)
- "반드시 해야 해" (강압)
- "실망이야" (죄책감)
- "다른 학생들은 다 하는데" (비교)
```

### 8.3 상황별 톤 조절

| 상황 | 톤 | 예시 |
|------|-----|------|
| 입학 첫날 | 환영 | "우리 학원에 온 걸 환영해! 🎉" |
| 연속 완료 | 축하 | "3일 연속! 대단해 🎉" |
| 첫 미완료 | 공감 | "오늘 힘들었구나, 괜찮아" |
| 연속 미완료 | 걱정 | "무슨 일 있어? 얘기해줘" |
| 다시 시작 | 환영 | "돌아왔구나! 다시 시작하자" |
| 플랜 수료 | 축하+유도 | "목표 달성! 다음은 뭘 도전해볼까? 🏆" |
| 휴식 선택 | 따뜻함 | "좋아, 푹 쉬어! 준비되면 언제든 불러줘 😊" |

### 8.4 알림 메시지 스타일 (카카오톡 스타일) ⭐ NEW

**핵심**: 앱 알림이 아닌, **친구가 카톡 보내는 것처럼** 느껴져야 한다.

```
❌ 일반 앱 알림 (딱딱함)
┌─────────────────────────────────────┐
│ 📚 AI학습코치              9:00 AM  │
│ 오늘의 학습을 시작하세요.           │
└─────────────────────────────────────┘

✅ 카톡 스타일 (친근함)
┌─────────────────────────────────────┐
│ 👨‍🎓 코치쌤                  9:00 AM  │
│ 철수야~ 오늘 수학 2단원이야!        │
│ 30분이면 끝나! 할 수 있어 💪        │
└─────────────────────────────────────┘
```

#### 시나리오별 알림 메시지

| 시나리오 | 알림 메시지 |
|----------|------------|
| 아침 브리핑 | "철수야~ 좋은 아침! ☀️ 오늘 수학이랑 영어야. 50분이면 끝나!" |
| 학습 시작 유도 | "공부 시작했어? 지금 하면 6시에 끝나! 💪" |
| 체크인 | "어때? 어려운 거 있어? 잠깐 쉬어도 돼~" |
| 완료 축하 | "오 대단해! 🎉 오늘도 해냈네! 진짜 멋있다" |
| 미완료 리마인더 | "철수야~ 아직 영어 남았는데, 오늘 힘들어?" |
| 저녁 리뷰 | "오늘 수고했어! 내일은 3단원이야. 푹 쉬어~ 🌙" |
| 위기 (3일 미학습) | "철수야... 요즘 바빴구나 😢 10분만 해볼까?" |
| 스트릭 축하 | "와 5일 연속! 🔥 진짜 대단하다!!" |
| 수료 축하 | "철수야!!! 🎊 수학1 완전 정복!! 자랑스러워!" |

#### 빠른 답장 지원

알림에서 바로 응답할 수 있는 버튼 제공:

```
┌─────────────────────────────────────┐
│ 👨‍🎓 코치쌤                   지금   │
│ 철수야~ 수학 끝났어?               │
│                                     │
│ [끝났어!] [하는 중] [나중에]        │
└─────────────────────────────────────┘
```

---

## 9. 개인화 학습 시스템 (Personalized Agent) ⭐ NEW

### 9.1 비전

**"학생과 함께 성장하는 나만의 AI 코치"**

코치쌤은 학생과의 대화, 학습 기록, 행동 패턴을 지속적으로 학습하여 점점 더 **그 학생만을 위한 개인 에이전트**로 진화한다.

```
┌─────────────────────────────────────────────────────────────────────┐
│                    🧠 개인화 학습 시스템                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   📊 학습 데이터 수집                                                │
│   ├── 대화 기록 (말투, 반응, 감정)                                   │
│   ├── 학습 패턴 (시간대, 집중력, 완료율)                             │
│   ├── 선호도 (칭찬 반응, 동기부여 방식)                              │
│   └── 취약점 (어려워하는 과목/단원)                                  │
│                                                                     │
│           ▼                                                         │
│                                                                     │
│   🧠 학생 프로파일 구축                                              │
│   ├── 성격 유형 (내향/외향, 꼼꼼/대충)                               │
│   ├── 학습 스타일 (시각/청각, 집중형/분산형)                         │
│   ├── 동기부여 패턴 (칭찬형/목표형/경쟁형)                           │
│   └── 커뮤니케이션 선호 (이모지 많이/적게, 길게/짧게)                │
│                                                                     │
│           ▼                                                         │
│                                                                     │
│   🎯 개인화된 코칭                                                   │
│   ├── 맞춤형 말투 & 톤                                              │
│   ├── 최적 학습 시간 추천                                           │
│   ├── 효과적인 동기부여 방식 적용                                    │
│   └── 취약점 집중 관리                                              │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 9.2 학습 데이터 수집

#### 9.2.1 대화 분석

| 수집 항목 | 분석 내용 | 활용 |
|-----------|-----------|------|
| **응답 패턴** | 짧은 답변 vs 긴 설명 | 메시지 길이 조절 |
| **이모지 사용** | 많이 씀 vs 안 씀 | 코치 이모지 빈도 조절 |
| **감정 표현** | 힘들어, 좋아, 짜증 등 | 감정 상태 파악 |
| **반응 시간** | 빠른 답장 vs 느린 답장 | 리마인더 타이밍 조절 |
| **대화 시간대** | 주로 대화하는 시간 | 알림 최적화 |

#### 9.2.2 학습 행동 분석

| 수집 항목 | 분석 내용 | 활용 |
|-----------|-----------|------|
| **학습 시간대** | 아침형 vs 저녁형 | 최적 학습 시간 추천 |
| **집중 시간** | 평균 집중 지속 시간 | 퀘스트 분량 조절 |
| **완료 패턴** | 한 번에 vs 나눠서 | 플랜 구성 최적화 |
| **스킵 패턴** | 어떤 과목/요일에 스킵 | 취약 시점 예측 |
| **난이도 피드백** | 어려워하는 유형 | 플랜 난이도 조절 |

#### 9.2.3 동기부여 반응 분석

| 코칭 유형 | 반응 측정 | 학습 결과 |
|-----------|-----------|-----------|
| 칭찬형 ("대단해!") | 다음 날 완료율 | 효과적이면 더 많이 |
| 목표형 ("D-3 남았어!") | 완료 속도 변화 | 효과적이면 강조 |
| 공감형 ("힘들었구나") | 재시작률 | 위기 시 활용 |
| 경쟁형 ("스트릭 유지!") | 연속 완료율 | 반응 좋으면 활용 |

### 9.3 학생 프로파일

```typescript
interface StudentProfile {
  // 기본 정보
  id: string;
  name: string;

  // 🧠 학습된 개인화 데이터
  personality: {
    // 대화 스타일
    preferredMessageLength: 'short' | 'medium' | 'long';
    emojiPreference: 'many' | 'some' | 'few';
    formalityLevel: 'casual' | 'balanced' | 'formal';

    // 학습 성향
    learningStyle: 'focused' | 'distributed';  // 몰아서 vs 나눠서
    motivationType: 'praise' | 'goal' | 'streak' | 'mixed';
    stressResponse: 'encouragement' | 'space' | 'humor';
  };

  // 📊 행동 패턴
  patterns: {
    // 시간 패턴
    peakHours: number[];           // 집중 잘 되는 시간
    avgSessionMinutes: number;      // 평균 학습 시간
    preferredStudyDays: string[];   // 선호 요일

    // 학습 패턴
    avgCompletionRate: number;
    skipTriggers: string[];         // 스킵 유발 요인
    crisisRecoveryDays: number;     // 위기 후 복귀까지 일수
  };

  // 📈 성장 기록
  growth: {
    totalStudyDays: number;
    longestStreak: number;
    completedPlans: number;
    strengthAreas: string[];
    weaknessAreas: string[];
  };

  // 🎯 코칭 최적화
  coaching: {
    effectiveMessages: string[];    // 효과적이었던 메시지 유형
    ineffectiveMessages: string[];  // 효과 없었던 메시지 유형
    bestReminderTiming: number;     // 최적 리마인더 간격 (분)
    crisisApproach: string;         // 위기 시 효과적인 접근법
  };

  // 최근 컨텍스트
  recentContext: {
    lastMood: string;
    currentChallenges: string[];
    upcomingEvents: string[];       // 시험, 여행 등
  };
}
```

### 9.4 개인화 적용 예시

#### 학생 A: 내성적, 칭찬에 민감
```
프로파일:
- emojiPreference: 'few'
- motivationType: 'praise'
- preferredMessageLength: 'short'

코치 메시지:
"수학 완료! 잘했어."
(짧고, 이모지 적게, 칭찬 포함)
```

#### 학생 B: 외향적, 목표 지향
```
프로파일:
- emojiPreference: 'many'
- motivationType: 'goal'
- preferredMessageLength: 'medium'

코치 메시지:
"대단해! 🎉🔥 이제 3일만 더 하면 수학1 완전 정복이야!
 목표까지 거의 다 왔어! 💪"
(목표 강조, 이모지 많이, 열정적)
```

#### 학생 C: 위기 상황, 스트레스 민감
```
프로파일:
- stressResponse: 'space'
- crisisApproach: '작은 목표 제시'

코치 메시지:
"요즘 바쁘구나. 괜찮아, 쉬어도 돼.
 준비되면 5분만 해볼까? 아니어도 괜찮아."
(압박 없이, 선택권 부여, 작은 목표)
```

### 9.5 지속적 학습 사이클

```
┌─────────────────────────────────────────────────────────────────────┐
│                    🔄 개인화 학습 사이클                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   1️⃣ 관찰 (Observe)                                                 │
│      │  대화, 학습 기록, 반응 수집                                   │
│      ▼                                                              │
│   2️⃣ 분석 (Analyze)                                                 │
│      │  패턴 인식, 선호도 파악, 효과 측정                            │
│      ▼                                                              │
│   3️⃣ 업데이트 (Update)                                              │
│      │  학생 프로파일 갱신                                          │
│      ▼                                                              │
│   4️⃣ 적용 (Apply)                                                   │
│      │  개인화된 코칭 메시지 생성                                    │
│      ▼                                                              │
│   5️⃣ 평가 (Evaluate)                                                │
│      │  적용 결과 측정 (완료율, 반응, 만족도)                        │
│      │                                                              │
│      └──────────────▶ 1️⃣ 관찰 (반복)                                │
│                                                                     │
│   💡 매주 프로파일 자동 업데이트                                     │
│   💡 월별 개인화 리포트 제공                                         │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 9.6 개인화 기능 요구사항

#### FR-070: 대화 학습
- 학생과의 모든 대화 기록 및 분석
- 응답 패턴, 감정, 선호도 추출
- 효과적인 메시지 유형 학습

#### FR-071: 행동 패턴 학습
- 학습 시간대, 집중 시간, 완료 패턴 분석
- 스킵/위기 발생 요인 예측
- 최적 학습 스케줄 추천

#### FR-072: 프로파일 자동 업데이트
- 주간 단위 프로파일 갱신
- 새로운 패턴 감지 시 즉시 반영
- 장기 성장 트렌드 추적

#### FR-073: 맞춤형 메시지 생성
- 학생 프로파일 기반 메시지 톤 조절
- 효과적인 동기부여 방식 자동 선택
- 상황별 최적 메시지 생성

#### FR-074: 개인화 인사이트 제공
- "너는 오전에 집중이 잘 되더라!"
- "칭찬하면 다음 날 더 열심히 하네 😊"
- "수요일에 스킵이 많아, 수요일엔 가볍게 하자"

### 9.7 프라이버시 & 데이터 관리

```
┌─────────────────────────────────────────────────────────────────────┐
│                    🔒 개인화 데이터 관리                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   📌 수집 동의                                                       │
│   - 개인화 기능 ON/OFF 선택 가능                                    │
│   - 어떤 데이터가 수집되는지 투명하게 안내                           │
│                                                                     │
│   📌 데이터 보관                                                     │
│   - 개인화 데이터는 암호화 저장                                      │
│   - 계정 삭제 시 모든 데이터 완전 삭제                               │
│                                                                     │
│   📌 사용자 제어                                                     │
│   - 내 프로파일 확인 기능                                           │
│   - 특정 데이터 삭제 요청 가능                                       │
│   - 개인화 리셋 기능                                                 │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 10. Memory Lane 학습 기억 시스템 ⭐ NEW

### 10.1 비전

**"학생의 모든 학습 순간을 기억하고, 맥락에 맞게 활용하는 AI"**

기존 개인화 시스템이 **프로파일 기반 적응**이라면, Memory Lane은 **기억 기반 학습**이다. 학생과의 모든 상호작용에서 의미 있는 학습 기억을 추출하고, 유사한 상황에서 이를 활용한다.

```
┌─────────────────────────────────────────────────────────────────────┐
│                    🧠 Memory Lane 시스템                             │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   📝 대화/학습 발생                                                  │
│       │                                                             │
│       ▼                                                             │
│   🔍 자동 기억 추출 (LearningMemoryCatcher)                          │
│       │  - 12가지 기억 유형 자동 분류                                │
│       │  - 과목/토픽 자동 감지                                       │
│       │  - 감정 상태 기록                                           │
│       ▼                                                             │
│   💾 벡터 DB 저장 (ChromaDB)                                         │
│       │  - 768차원 임베딩                                           │
│       │  - 메타데이터 17개 필드                                      │
│       ▼                                                             │
│   🎯 Query-Aware 검색                                                │
│       │  - 6-factor 가중치 랭킹                                      │
│       │  - D-Day 긴급도 부스팅                                       │
│       ▼                                                             │
│   💬 맥락 주입                                                       │
│       - LLM 프롬프트에 관련 기억 포함                                │
│       - 과거 실수/성공 패턴 참조                                     │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 10.2 12가지 학습 기억 유형

#### 핵심 유형 (6개)

| 유형 | 트리거 키워드 | 예시 |
|------|---------------|------|
| **CORRECTION** | "아니 그게 아니고", "틀렸어" | 학생이 교정한 내용 |
| **DECISION** | "~하기로 했어", "결정했어" | 학습 관련 결정 |
| **INSIGHT** | "아! 이해했어", "이거구나" | 깨달음의 순간 |
| **PATTERN** | "항상 ~해", "맨날 ~하더라" | 행동 패턴 |
| **GAP** | "처음 봐", "모르겠어" | 지식 공백 |
| **LEARNING** | 기본값 | 일반 학습 내용 |

#### 교육 확장 유형 (6개) ⭐

| 유형 | 트리거 키워드 | 예시 | 활용 |
|------|---------------|------|------|
| **MASTERY** | "완벽해", "이젠 쉬워" | 숙달된 개념 | 복습 스킵 가능 |
| **STRUGGLE** | "헷갈려", "어려워" | 어려워하는 부분 | 집중 관리 |
| **WRONG_ANSWER** | 오답 시 자동 | 틀린 문제 기록 | 오답노트 |
| **STRATEGY** | "이렇게 풀면 돼" | 문제 해결 전략 | 유사 문제에 활용 |
| **PREFERENCE** | "이게 더 좋아" | 학습 선호도 | 콘텐츠 최적화 |
| **EMOTION** | "스트레스", "재밌어" | 감정 상태 | 심리 케어 |

### 10.3 자동 기억 추출

```typescript
interface LearningMemory {
  id: string;
  type: MemoryType;            // 12가지 유형
  subject: Subject;            // 과목 자동 감지
  topic: string;               // 토픽/단원
  title: string;               // 요약 제목
  content: string;             // 상세 내용

  // 품질 메트릭
  confidence: number;          // 추출 신뢰도 (0.6-0.9)
  difficulty: number;          // 난이도 (1-5)
  masteryScore: number;        // 숙달도 (0-10, EMA)

  // 추적 메타데이터
  timesObserved: number;       // 관찰 횟수
  recallCount: number;         // 검색/활용 횟수
  positiveFeedback: number;    // 긍정 피드백
  negativeFeedback: number;    // 부정 피드백

  // 시간 정보
  createdAt: Date;
  lastRecalled: Date;
  emotionAtCreation: Emotion;  // 생성 시 감정 상태
}

// 자동 추출 파이프라인
class LearningMemoryCatcher {
  extract(conversation: Message[], studyResult: StudyRecord): LearningMemory[] {
    // 1. 과목 자동 감지 (정규식 + 컨텍스트)
    // 2. 기억 유형 분류 (14개 패턴 매칭)
    // 3. 토픽 추출 (키워드 + 의미 분석)
    // 4. 신뢰도 점수 산정
    // 5. 감정 상태 기록
    return memories;
  }
}
```

### 10.4 Query-Aware 검색 (6-Factor Re-Ranking)

```typescript
interface RetrievalWeights {
  semanticSimilarity: 0.45;    // 벡터 유사도 (기본)
  recency: 0.10;               // 최근성 (7일 감쇠)
  confidence: 0.10;            // 추출 품질
  typeBoost: 0.15;             // 질문 의도 ↔ 기억 유형 매칭
  subjectMatch: 0.10;          // 현재 과목 일치
  urgencyBoost: 0.10;          // D-Day 긴급도
}
```

#### Type Boost 키워드 매핑

```typescript
const TYPE_BOOST_KEYWORDS = {
  CORRECTION: ["실수", "틀렸", "다시", "정정"],
  WRONG_ANSWER: ["오답", "틀린 문제", "왜 틀렸"],
  MASTERY: ["완벽", "숙달", "잘해", "쉬워"],
  STRUGGLE: ["어렵", "헷갈", "모르겠", "이해 안"],
  STRATEGY: ["풀이법", "접근", "어떻게 풀"],
  EMOTION: ["스트레스", "힘들", "기분", "피곤"],
  GAP: ["처음", "새로운", "배운 적 없"]
};
```

#### D-Day 긴급도 부스팅

```typescript
function calculateUrgencyBoost(dDay: number, subject: Subject): number {
  let base = 0.05;  // 기본값

  if (dDay <= 7) base = 0.30;       // 시험 1주일 전
  else if (dDay <= 30) base = 0.20; // 시험 1달 전
  else if (dDay <= 100) base = 0.10;

  // 수학은 추가 가중치 (핵심 과목)
  if (subject === 'math') base += 0.05;

  return base;
}
```

### 10.5 SM-2 간격 반복 학습

**SuperMemo 2 알고리즘**을 적용하여 토픽별 복습 일정을 자동 관리한다.

```typescript
interface TopicMastery {
  topicId: string;
  masteryScore: number;        // 0-10 (EMA 기반)
  easinessFactor: number;      // 난이도 계수 (2.5 기본)
  interval: number;            // 복습 간격 (일)
  repetitions: number;         // 반복 횟수
  nextReviewDate: Date;        // 다음 복습 예정일
}

// SM-2 품질 척도 (0-5)
// 5: 완벽한 기억
// 4: 약간 망설임
// 3: 힌트 후 맞춤
// 2: 틀렸다가 바로 수정
// 1: 오답
// 0: 완전 실패

function updateSM2(topic: TopicMastery, quality: number): TopicMastery {
  if (quality < 3) {
    // 실패: 처음부터 다시
    topic.repetitions = 0;
    topic.interval = 1;
  } else {
    // 성공: 간격 확장
    if (topic.repetitions === 0) topic.interval = 1;
    else if (topic.repetitions === 1) topic.interval = 6;
    else topic.interval = Math.min(30, topic.interval * topic.easinessFactor);

    topic.repetitions++;
  }

  // 난이도 계수 조정
  topic.easinessFactor = Math.max(1.3,
    topic.easinessFactor + 0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02)
  );

  topic.nextReviewDate = addDays(new Date(), topic.interval);
  return topic;
}
```

### 10.6 숙달도 점수 (EMA 기반)

**지수이동평균(EMA)**으로 숙달도를 부드럽게 업데이트한다.

```typescript
const EMA_ALPHA = 0.3;  // 스무딩 계수

function updateMasteryScore(current: number, newScore: number): number {
  // EMA: 새 값에 30%, 기존 값에 70% 가중치
  return EMA_ALPHA * newScore + (1 - EMA_ALPHA) * current;
}

// 숙달 레벨 판정
type MasteryLevel = 'BEGINNER' | 'INTERMEDIATE' | 'ADVANCED' | 'EXPERT';

function getMasteryLevel(score: number): MasteryLevel {
  if (score >= 8.0) return 'EXPERT';      // 완전 숙달
  if (score >= 6.0) return 'ADVANCED';    // 상급
  if (score >= 4.0) return 'INTERMEDIATE'; // 중급
  return 'BEGINNER';                       // 초급
}
```

### 10.7 번아웃 감지 시스템

```typescript
interface BurnoutTracker {
  level: 'LOW' | 'MEDIUM' | 'HIGH';
  consecutiveNegativeDays: number;   // 연속 부정 감정 일수
  negativeRatio7Days: number;        // 7일간 부정 감정 비율
  lastPositiveEmotion: Date;         // 마지막 긍정 감정
}

// 감정 키워드 매핑
const EMOTION_KEYWORDS = {
  STRESSED: ["스트레스", "힘들", "지쳐", "포기", "싫어"],
  ANXIOUS: ["불안", "걱정", "긴장", "무서워"],
  FRUSTRATED: ["짜증", "화나", "열받", "안 풀려"],
  TIRED: ["졸려", "피곤", "쉬고싶"],
  MOTIVATED: ["화이팅", "열심히", "할 수 있어"],
  CONFIDENT: ["자신", "잘할", "쉬워", "완벽"]
};

// 번아웃 레벨 판정
function assessBurnout(tracker: BurnoutTracker): 'LOW' | 'MEDIUM' | 'HIGH' {
  if (tracker.consecutiveNegativeDays >= 5 || tracker.negativeRatio7Days > 0.7) {
    return 'HIGH';  // 긴급 개입 필요
  }
  if (tracker.consecutiveNegativeDays >= 3 || tracker.negativeRatio7Days > 0.5) {
    return 'MEDIUM';  // 주의 필요
  }
  return 'LOW';
}
```

### 10.8 스트레스 대처 전략

번아웃 감지 시 자동으로 대처 전략을 제시한다.

```typescript
const COPING_STRATEGIES = {
  STRESSED: [
    "4-7-8 호흡법 (4초 들이쉬고, 7초 참고, 8초 내쉬기)",
    "10분 산책하고 오기",
    "좋아하는 음악 한 곡 듣기",
    "따뜻한 차 한 잔 마시기"
  ],
  ANXIOUS: [
    "지금 할 수 있는 딱 하나에만 집중하기",
    "걱정 일기 써보기",
    "예전에 잘 해낸 경험 떠올리기",
    "친구나 가족과 이야기하기"
  ],
  FRUSTRATED: [
    "5분 쉬고 돌아오기",
    "다른 과목으로 바꿔보기",
    "어려운 부분 메모하고 나중에 다시 보기",
    "스트레칭하기"
  ],
  TIRED: [
    "15분 파워 냅 자기",
    "물 한 잔 마시기",
    "창문 열어 환기하기",
    "눈 감고 1분 휴식"
  ]
};
```

### 10.9 Memory Lane 기능 요구사항

#### FR-080: 자동 기억 추출
- 모든 대화/학습에서 의미 있는 기억 자동 추출
- 12가지 유형으로 자동 분류
- 과목/토픽 자동 감지

#### FR-081: 벡터 기반 저장
- ChromaDB에 768차원 임베딩 저장
- 17개 메타데이터 필드 관리
- 1000+ 기억 고속 검색 지원

#### FR-082: Query-Aware 검색
- 6-factor 가중치 기반 Re-Ranking
- D-Day 긴급도 자동 반영
- 질문 의도 ↔ 기억 유형 매칭

#### FR-083: SM-2 복습 스케줄링
- 토픽별 숙달도 추적
- 자동 복습 일정 생성
- 취약 토픽 우선 복습 안내

#### FR-084: 번아웃 감지 & 케어
- 7일 감정 추이 모니터링
- 번아웃 레벨 자동 판정
- 상황별 대처 전략 제시

#### FR-085: LLM 컨텍스트 주입
- 관련 기억 top-K 검색
- 시스템 프롬프트에 자동 주입
- 과거 실수/성공 패턴 참조 응답
